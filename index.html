<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#3b82f6">
    <title>World Data Map</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: #f8fafc;
            min-height: 100vh;
            color: #1a202c;
            line-height: 1.6;
            /* Ensure no scrollbar issues with fixed positioning */
            overflow-x: hidden;
        }

        .app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }

        /* Global smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Enhanced focus states for accessibility */
        button:focus,
        a:focus,
        select:focus,
        input:focus {
            outline: 2px solid #1e40af;
            outline-offset: 2px;
        }

        /* Improved loading states */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
            color: #64748b;
            font-weight: 500;
            font-size: 1.125rem;
        }

        .spinner {
            border: 3px solid #e2e8f0;
            border-top: 3px solid #1e40af;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin-right: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .header {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: #1a202c;
            padding: 2rem 0;
            border-bottom: 2px solid #cbd5e1;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .header-content {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .header h1 {
            color: #1e40af;
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin: 0;
            text-shadow: 0 1px 2px rgba(30, 64, 175, 0.1);
            letter-spacing: -0.025em;
        }

        .header p {
            color: #475569;
            text-align: center;
            margin-top: 0.75rem;
            font-size: 1rem;
            font-weight: 500;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.5;
        }

        .header-stats {
            display: flex !important;
            justify-content: center !important;
            gap: 0.75rem !important;
            margin-top: 0.5rem !important;
            flex-wrap: nowrap !important;
            flex-direction: row !important;
            align-items: center !important;
            background: rgba(241, 245, 249, 0.95);
            backdrop-filter: blur(10px);
            padding: 0.5rem;
            border-radius: 8px;
        }

        /* Country Search Box Styles */
        .search-container {
            position: relative;
            max-width: 400px;
            margin: 1rem auto;
            z-index: 1000;
        }

        .search-box {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .search-box:focus {
            outline: none;
            border-color: #1e40af;
            box-shadow: 0 4px 20px rgba(30, 64, 175, 0.2);
            background: rgba(255, 255, 255, 1);
        }

        .search-box::placeholder {
            color: #94a3b8;
            font-style: italic;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border: 2px solid #e2e8f0;
            border-top: none;
            border-radius: 0 0 12px 12px;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            z-index: 1001;
            display: none;
        }

        .search-results.show {
            display: block;
            animation: slideDown 0.2s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .search-result-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 1px solid #f1f5f9;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .search-result-item:hover {
            background: #f8fafc;
            color: #1e40af;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-item .country-flag {
            font-size: 1.25rem;
            width: 24px;
            text-align: center;
        }

        .search-result-item .country-name {
            flex: 1;
            font-weight: 500;
        }

        .search-result-item .country-code {
            color: #64748b;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .search-result-item .country-region {
            color: #94a3b8;
            font-size: 0.75rem;
            font-style: italic;
        }

        .no-results {
            padding: 1rem;
            text-align: center;
            color: #64748b;
            font-style: italic;
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            pointer-events: none;
        }

        .search-box-with-icon {
            padding-left: 2.5rem;
        }

        /* Enhanced Navigation Styles */
        .navigation {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            border-bottom: 2px solid #1e40af;
            box-shadow: 0 2px 10px rgba(30, 64, 175, 0.2);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
            gap: 0;
            height: 100%;
            align-items: center;
            justify-content: center;
        }

        .nav-item {
            margin: 0;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1.25rem 1.75rem;
            color: #ffffff;
            text-decoration: none;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .nav-link:hover::before {
            left: 100%;
        }

        .nav-link:hover {
            color: #ffffff;
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .nav-item.active .nav-link {
            color: #ffffff;
            border-bottom-color: #fbbf24;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .nav-icon {
            font-size: 1.125rem;
        }

        .stat-item {
            text-align: center;
            padding: 0.375rem !important;
            background: rgba(241, 245, 249, 0.9) !important;
            border: 1px solid rgba(203, 213, 225, 0.8) !important;
            border-radius: 6px !important;
            min-width: 70px !important;
            flex: 1 !important;
            max-width: 90px !important;
            display: inline-block !important;
            float: none !important;
            clear: none !important;
            backdrop-filter: blur(5px);
        }

        .stat-number {
            display: block !important;
            font-size: 1rem !important;
            font-weight: 700 !important;
            color: #1e40af !important;
            margin-bottom: 0.125rem !important;
        }

        .stat-label {
            display: block !important;
            font-size: 0.625rem !important;
            color: #475569 !important;
            font-weight: 500 !important;
        }
        
        /* Force horizontal layout */
        .header-stats > * {
            display: inline-block !important;
            vertical-align: top !important;
        }

        .main-content {
            flex: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .map-container {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 2px solid #cbd5e1;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .map-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .map-header h2 {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 0.75rem;
            text-shadow: 0 1px 2px rgba(30, 64, 175, 0.1);
        }

        .map-header p {
            color: #475569;
            font-size: 1.125rem;
            font-weight: 500;
            line-height: 1.5;
        }

        .world-map {
            height: 600px;
            background: linear-gradient(135deg, #e6f3ff 0%, #f0f8ff 100%);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            border: 2px solid #cbd5e1;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            /* Performance optimizations */
            will-change: transform;
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        .country {
            fill: #90EE90;
            stroke: #228B22;
            stroke-width: 0.8;
            cursor: pointer;
            transition: fill 0.2s ease, stroke 0.2s ease;
            /* Performance optimizations */
            will-change: fill, stroke;
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
            /* Prevent flickering */
            pointer-events: auto;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .country:hover {
            fill: #98FB98;
            stroke: #32CD32;
            stroke-width: 1.2;
        }

        .country.selected {
            fill: #FF6B6B;
            stroke: #DC143C;
            stroke-width: 2.5;
            filter: drop-shadow(0 0 8px rgba(220, 20, 60, 0.3));
        }

        /* Prevent hover flickering on small countries */
        .country:hover:not(.selected) {
            z-index: 10;
            /* Prevent aggressive hover effects that cause flickering */
            transform: none;
            transition: fill 0.15s ease, stroke 0.15s ease;
        }

        /* Optimize small country interactions */
        .country {
            /* Ensure consistent cursor behavior */
            cursor: pointer !important;
            /* Prevent text selection */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            /* Smooth transitions */
            transition: fill 0.15s ease, stroke 0.15s ease;
        }

        /* Prevent flickering on hover state changes */
        .country:hover {
            /* Remove transform to prevent flickering */
            transform: none;
            /* Ensure smooth color transitions */
            transition: fill 0.15s ease, stroke 0.15s ease;
        }

        .country-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 0.5rem;
            border-radius: 4px;
            font-size: 0.875rem;
            pointer-events: none;
            z-index: 1000;
            max-width: 200px;
        }

        .data-panel {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            padding: 2rem;
            border: 2px solid #e2e8f0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .data-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .data-header h2 {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 0.75rem;
            text-shadow: 0 1px 2px rgba(30, 64, 175, 0.1);
        }

        .data-content {
            padding: 0;
        }

        .no-selection {
            text-align: center;
            color: #64748b;
            font-size: 1.125rem;
            padding: 3rem 1rem;
            font-weight: 400;
        }
        
        .data-quality-indicator {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        
        .quality-badge {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
            transition: all 0.2s ease;
        }
        
        .quality-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .country-info {
            margin-bottom: 2rem;
        }

        .country-name {
            font-size: 2rem;
            font-weight: 800;
            color: #1a202c;
            margin-bottom: 1rem;
            text-align: center;
            letter-spacing: -0.025em;
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .data-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 12px;
            padding: 2rem;
            border: 2px solid #e2e8f0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .data-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .data-card h3 {
            color: #1e40af;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-shadow: 0 1px 2px rgba(30, 64, 175, 0.1);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: #ffffff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-table th {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            font-weight: 600;
            color: #ffffff;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table td {
            color: #1a202c;
            font-size: 0.875rem;
            background: #ffffff;
        }

        .data-table tr:hover {
            background: #f8fafc;
            transform: scale(1.01);
            transition: all 0.2s ease;
        }

        .data-table tr:nth-child(even) td {
            background: #f8fafc;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
            color: #64748b;
            font-weight: 400;
        }

        @media (max-width: 768px) {
            .loading {
                padding: 2rem 1rem;
                text-align: center;
                flex-direction: column;
            }
            
            .spinner {
                margin-right: 0;
                margin-bottom: 1rem;
            }
            
            .container {
                padding: 0.5rem;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            .controls {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .control-group {
                width: 100%;
            }
            
            .control-group select,
            .control-group input {
                width: 100%;
            }
            
            .data-panel {
                margin-top: 1rem;
                padding: 1rem;
            }
            
            .indicator-section {
                margin-bottom: 1.5rem;
            }
            
            .section-header h3 {
                font-size: 1.2rem;
            }
            
            .current-indicators {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .indicator-item {
                padding: 0.75rem;
            }
            
            .data-table {
                font-size: 0.8rem;
            }
            
            .data-table th,
            .data-table td {
                padding: 0.5rem 0.25rem;
            }
            
            .top5-rankings {
                font-size: 0.8rem;
                padding: 0.75rem;
            }
            
            .forecast-table-container {
                margin-bottom: 1.5rem;
            }
            
            .forecast-table {
                font-size: 0.75rem;
            }
            
            .forecast-table th,
            .forecast-table td {
                padding: 0.25rem;
            }
            
            .forecast-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .forecast-card {
                padding: 1rem;
            }
        }

        .spinner {
            border: 3px solid #e2e8f0;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin-right: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }









        .icon {
            width: 20px;
            height: 20px;
            display: inline-block;
            margin-right: 0.5rem;
        }

        .trend-up {
            color: #48bb78;
        }

        .trend-down {
            color: #f56565;
        }

                 .trend-neutral {
             color: #718096;
         }

         .indicator-section {
             margin-bottom: 2rem;
             border: 1px solid #e2e8f0;
             border-radius: 12px;
             padding: 1.5rem;
             background: #f8fafc;
         }

                 .section-header h3 {
            margin: 0 0 1rem 0;
            color: #1e40af;
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-shadow: 0 1px 2px rgba(30, 64, 175, 0.1);
        }

         .visualization-note {
             font-size: 0.85rem;
             color: #718096;
             font-style: italic;
             margin-bottom: 1rem;
         }

         .current-indicators {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
             gap: 1rem;
             margin-bottom: 1rem;
         }

         .indicator-item {
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 0.75rem 1rem;
             background: white;
             border-radius: 8px;
             border: 1px solid #e2e8f0;
         }

         .indicator-label {
             font-weight: 500;
             color: #4a5568;
             font-size: 0.9rem;
         }

         .indicator-value {
             font-weight: 600;
             font-size: 1rem;
         }

         .top5-rankings {
             margin-top: 1rem;
             padding: 1rem;
             background: rgba(59, 130, 246, 0.1);
             border-radius: 8px;
             border-left: 4px solid #3b82f6;
             font-size: 0.9rem;
         }

                 .visualization-section {
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
            border-radius: 12px;
            padding: 1.5rem;
        }

         .chart-grid {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
             gap: 1.5rem;
             margin-bottom: 2rem;
         }

         .chart-card {
             background: #f1f5f9;
             border: 1px solid #cbd5e1;
             border-radius: 12px;
             padding: 1rem;
         }

         .chart-card h4 {
             margin: 0 0 1rem 0;
             color: #1e40af;
             font-size: 1rem;
             text-align: center;
         }

         .chart-placeholder {
             background: rgba(255, 255, 255, 0.9);
             border-radius: 8px;
             padding: 0.5rem;
             display: flex;
             align-items: center;
             justify-content: center;
         }

         .chart-summary {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
             gap: 1rem;
         }

         .summary-item {
             display: flex;
             align-items: center;
             gap: 0.75rem;
             padding: 0.75rem;
             background: rgba(255, 255, 255, 0.1);
             border-radius: 8px;
             backdrop-filter: blur(5px);
         }

         .summary-icon {
             font-size: 1.5rem;
         }

         .summary-text {
             font-size: 0.9rem;
             line-height: 1.4;
         }

         .analytics-section {
             background: #f1f5f9;
             border: 1px solid #cbd5e1;
             border-radius: 12px;
             padding: 1.5rem;
         }

         .forecasting-section {
             background: #f1f5f9;
             border: 1px solid #cbd5e1;
             border-radius: 12px;
             padding: 1.5rem;
         }

         .forecast-grid {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
             gap: 1.5rem;
             margin-bottom: 2rem;
         }

         .forecast-card {
             background: #f1f5f9;
             border: 1px solid #cbd5e1;
             border-radius: 12px;
             padding: 1.5rem;
         }

         .forecast-card h4 {
             margin: 0 0 1rem 0;
             color: #1e40af;
             font-size: 1.1rem;
             text-align: center;
         }

         .forecast-value {
             text-align: center;
             margin-bottom: 1rem;
         }

         .forecast-year {
             display: block;
             font-size: 0.9rem;
             color: #475569;
             margin-bottom: 0.5rem;
         }

         .forecast-main {
             display: block;
             font-size: 1.5rem;
             font-weight: 700;
             color: #1e40af;
             margin-bottom: 0.25rem;
         }

         .forecast-range {
             display: block;
             font-size: 0.85rem;
             color: #64748b;
         }

         .forecast-trend {
             text-align: center;
             font-size: 0.9rem;
             padding: 0.5rem;
             background: #e2e8f0;
             border-radius: 6px;
             color: #475569;
         }

         .forecast-methodology {
             background: rgba(255, 255, 255, 0.1);
             border-radius: 8px;
             padding: 1rem;
             font-size: 0.85rem;
             line-height: 1.4;
             backdrop-filter: blur(5px);
         }

         .forecast-methodology p {
             margin: 0;
         }

         .calculation-formulas {
             background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
             border: 2px solid #cbd5e1;
             border-radius: 16px;
             padding: 2rem;
             margin-bottom: 2rem;
             box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
         }

         .calculation-formulas h4 {
             margin: 0 0 1.5rem 0;
             color: #1e40af;
             font-size: 1.5rem;
             font-weight: 700;
             text-align: center;
             text-shadow: 0 1px 2px rgba(30, 64, 175, 0.1);
         }

         .formula-grid {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
             gap: 1.5rem;
         }

         .formula-item {
             background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%);
             border-radius: 12px;
             padding: 1.25rem;
             font-size: 1rem;
             border: 2px solid #e2e8f0;
             color: #475569;
             box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
             transition: all 0.3s ease;
             text-align: center;
         }

         .formula-item:hover {
             transform: translateY(-2px);
             box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
             border-color: #1e40af;
         }

         .formula-item strong {
             color: #1e40af;
             font-weight: 700;
         }

         .yearly-forecasts {
             margin-bottom: 2rem;
         }

         .forecast-table-container {
             background: #f1f5f9;
             border: 1px solid #cbd5e1;
             border-radius: 12px;
             padding: 1.5rem;
             margin-bottom: 1.5rem;
         }

         .forecast-table-container h4 {
             margin: 0 0 1rem 0;
             color: #1e40af;
             text-align: center;
             font-size: 1.25rem;
             font-weight: 600;
         }

         .forecast-table {
             width: 100%;
             border-collapse: collapse;
             background: rgba(255, 255, 255, 0.05);
             border-radius: 8px;
             overflow: hidden;
         }

         .forecast-table th,
         .forecast-table td {
             padding: 0.75rem;
             text-align: center;
             border-bottom: 1px solid rgba(255, 255, 255, 0.1);
         }

         .forecast-table th {
             background: #e2e8f0;
             font-weight: 600;
             color: #475569;
             text-transform: uppercase;
             font-size: 0.8rem;
             letter-spacing: 0.5px;
         }

         .forecast-table td {
             color: #1a202c;
             font-size: 0.9rem;
         }

         .forecast-table tr:hover {
             background: #e2e8f0;
         }

         .forecast-table .trend-up {
             color: #10b981;
             font-weight: 600;
         }

         .forecast-table .trend-down {
             color: #ef4444;
             font-weight: 600;
         }

         /* Enhanced Sources Section */
         .sources-section {
             background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
             color: white;
             padding: 5rem 0;
             margin-top: 3rem;
             position: relative;
             overflow: hidden;
         }

         .sources-section::before {
             content: '';
             position: absolute;
             top: 0;
             left: 0;
             right: 0;
             bottom: 0;
             background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="rgba(255,255,255,0.03)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
             pointer-events: none;
         }

         .sources-section h2 {
             text-align: center;
             font-size: 3rem;
             margin-bottom: 4rem;
             color: white;
             text-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
             font-weight: 800;
             letter-spacing: -0.025em;
         }

         .sources-grid {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
             gap: 2rem;
             margin-bottom: 3rem;
         }

         .source-category {
             background: rgba(255, 255, 255, 0.1);
             border-radius: 12px;
             padding: 2rem;
             backdrop-filter: blur(10px);
             border: 1px solid rgba(255, 255, 255, 0.2);
         }

         .source-category h3 {
             color: #fbbf24;
             font-size: 1.3rem;
             margin-bottom: 1rem;
             text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
         }

         .source-category ul {
             list-style: none;
             padding: 0;
             margin: 0;
         }

         .source-category li {
             margin-bottom: 0.75rem;
             padding-left: 1rem;
             position: relative;
             line-height: 1.5;
         }

         .source-category li:before {
             content: "▶";
             position: absolute;
             left: 0;
             color: #fbbf24;
             font-size: 0.8rem;
         }

         .source-category strong {
             color: #ffffff;
             font-weight: 600;
         }

         .methodology-note {
             background: rgba(255, 255, 255, 0.15);
             border-radius: 12px;
             padding: 2rem;
             border: 1px solid rgba(255, 255, 255, 0.3);
             backdrop-filter: blur(10px);
             text-align: center;
         }

         .methodology-note p {
             margin: 0;
             font-size: 1rem;
             line-height: 1.6;
             color: #f3f4f6;
         }

         /* Enhanced Footer Signature */
         .footer-signature {
             background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
             color: white;
             padding: 3rem 0;
             border-top: 3px solid #fbbf24;
             position: relative;
             overflow: hidden;
         }

         .footer-signature::before {
             content: '';
             position: absolute;
             top: 0;
             left: 0;
             right: 0;
             bottom: 0;
             background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="stars" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="20" cy="20" r="0.5" fill="rgba(251,191,36,0.3)"/><circle cx="80" cy="40" r="0.3" fill="rgba(251,191,36,0.2)"/><circle cx="40" cy="80" r="0.4" fill="rgba(251,191,36,0.25)"/></pattern></defs><rect width="100" height="100" fill="url(%23stars)"/></svg>');
             pointer-events: none;
         }

         .signature-content {
             display: flex;
             flex-direction: column;
             align-items: center;
             justify-content: center;
             gap: 1.5rem;
             width: 100%;
             max-width: 1200px;
             margin: 0 auto;
             position: relative;
             z-index: 1;
         }

         .signature-text {
             font-size: 1.5rem;
             font-weight: 700;
             color: #fbbf24;
             text-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);
             text-align: center;
             letter-spacing: 0.025em;
         }

         .tech-stack {
             font-size: 0.9rem;
             color: #cbd5e1;
             font-style: normal;
             font-weight: 400;
             text-align: center;
             line-height: 1.5;
             width: 100%;
             max-width: 700px;
             margin: 1rem auto 0;
             padding: 0.75rem 1.5rem;
             background: none;
             border: none;
             border-radius: 0;
             display: block;
             opacity: 0.9;
         }

         /* Language Selector */
         .header-top {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 1rem;
         }

         .language-selector {
             display: flex;
             gap: 0.5rem;
         }

         .lang-btn {
             padding: 0.375rem 0.75rem;
             border: 1px solid #cbd5e1;
             background: #f1f5f9;
             color: #475569;
             border-radius: 6px;
             cursor: pointer;
             font-weight: 500;
             transition: all 0.2s ease;
             font-size: 0.75rem;
             margin-left: 0.5rem;
         }

         .lang-btn:hover {
             background: #e2e8f0;
             border-color: #94a3b8;
         }

         .lang-btn.active {
             background: #3b82f6;
             color: white;
             border-color: #3b82f6;
         }

         /* Mobile Optimizations */
         @media (max-width: 768px) {
             /* Header Mobile */
             .header h1 {
                 font-size: 1.8rem;
                 line-height: 1.2;
                 margin-bottom: 0.5rem;
             }
             
             .header p {
                 font-size: 0.9rem;
                 line-height: 1.4;
             }
             
             .header-stats {
                 display: flex !important;
                 flex-direction: row !important;
                 flex-wrap: nowrap !important;
                 gap: 0.5rem !important;
             }
             
             .stat-item {
                 padding: 0.75rem;
             }
             
             .stat-number {
                 font-size: 1.5rem;
             }
             
             .stat-label {
                 font-size: 0.8rem;
             }
             
             .header-top {
                 flex-direction: column;
                 gap: 1rem;
                 text-align: center;
             }

             .lang-btn {
                 padding: 0.4rem 0.8rem;
                 font-size: 0.8rem;
             }
             
             /* Map Container Mobile */
             .map-container {
                 padding: 0.5rem;
             }
             
             .map-header h2 {
                 font-size: 1.3rem;
             }
             
             .map-header p {
                 font-size: 0.85rem;
             }
             
             /* Data Panel Mobile */
             .data-panel {
                 margin: 0.5rem;
                 padding: 1rem;
             }
             
             .data-header h2 {
                 font-size: 1.4rem;
             }
             
             .indicator-section {
                 margin-bottom: 1.5rem;
                 padding: 1rem;
             }
             
             .section-header h3 {
                 font-size: 1.2rem;
             }
             
             .visualization-note {
                 font-size: 0.8rem;
             }
             
             .current-indicators {
                 grid-template-columns: 1fr;
                 gap: 0.75rem;
             }
             
             .indicator-item {
                 padding: 0.75rem;
             }
             
             .indicator-label {
                 font-size: 0.85rem;
             }
             
             .indicator-value {
                 font-size: 1rem;
             }
             
             /* Forecast Tables Mobile */
             .forecast-grid {
                 grid-template-columns: 1fr;
                 gap: 1rem;
             }
             
             .forecast-table-container {
                 padding: 1rem;
                 margin-bottom: 1rem;
             }
             
             .forecast-table {
                 font-size: 0.8rem;
             }
             
             .forecast-table th,
             .forecast-table td {
                 padding: 0.5rem 0.25rem;
             }
             
             /* Sources Section Mobile */
             .sources-grid {
                 grid-template-columns: 1fr;
             }
             
             .sources-section h2 {
                 font-size: 2rem;
             }
             
             .source-category {
                 padding: 1.5rem;
             }
             
             .source-category h3 {
                 font-size: 1.1rem;
             }
             
             .source-category li {
                 font-size: 0.85rem;
                 margin-bottom: 0.5rem;
             }
             
             /* Footer Mobile */
             .signature-text {
                 font-size: 1rem;
                 text-align: center;
                 padding: 0 1rem;
             }
             
             .tech-stack {
                 font-size: 0.8rem;
                 padding: 0.5rem 1rem;
                 line-height: 1.4;
             }
             
             /* Zoom Controls Mobile */
             .zoom-controls {
                 top: 10px;
                 right: 10px;
             }
             
             .zoom-btn {
                 width: 40px;
                 height: 40px;
                 font-size: 1.2rem;
             }
         }
         
         /* Small Mobile Devices */
         @media (max-width: 480px) {
             .header h1 {
                 font-size: 1.5rem;
             }
             
             .header-stats {
                 display: flex !important;
                 flex-direction: row !important;
                 flex-wrap: nowrap !important;
                 gap: 0.5rem !important;
             }
             
             .stat-item {
                 padding: 0.5rem;
             }
             
             .data-panel {
                 margin: 0.25rem;
                 padding: 0.75rem;
             }
             
             .indicator-section {
                 padding: 0.75rem;
             }
             
             .forecast-card {
                 padding: 1rem;
             }
             
             .forecast-main {
                 font-size: 1.2rem;
             }
             
             .zoom-btn {
                 width: 35px;
                 height: 35px;
                 font-size: 1rem;
             }
         }
         
         /* Touch Device Optimizations */
         @media (hover: none) and (pointer: coarse) {
             .country {
                 cursor: pointer;
             }
             
             .lang-btn {
                 min-height: 44px;
                 min-width: 44px;
             }
             
             .zoom-btn {
                 min-height: 44px;
                 min-width: 44px;
             }
             
             .indicator-item {
                 min-height: 44px;
             }
             
             .forecast-card {
                 min-height: 44px;
             }

             /* Improve touch scrolling */
             .data-panel {
                 -webkit-overflow-scrolling: touch;
                 overflow-y: auto;
                 max-height: 70vh;
             }

             /* Better touch targets for mobile */
             .indicator-section {
                 margin-bottom: 1rem;
                 border-radius: 12px;
             }

             .forecast-table th,
             .forecast-table td {
                 padding: 0.75rem 0.5rem;
                 min-width: 60px;
             }
         }

                 /* Enhanced Mobile Responsiveness */
        @media (max-width: 768px) {
            .search-container {
                max-width: 90%;
                margin: 0.75rem auto;
            }
            
            .search-box {
                padding: 0.875rem 1rem;
                font-size: 1rem;
            }
            
            .search-results {
                max-height: 250px;
            }
            
            .search-result-item {
                padding: 1rem;
                font-size: 0.9rem;
            }
            
            .data-panel {
                margin: 0.5rem;
                border-radius: 12px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
                padding: 1rem;
            }

            .indicator-section {
                margin-bottom: 1rem;
                border-radius: 10px;
                padding: 1rem;
            }

            .forecast-table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                padding: 1rem;
            }

            .forecast-table {
                min-width: 600px;
            }

            .forecast-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .forecast-card {
                padding: 1rem;
            }

            .current-indicators {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .indicator-item {
                padding: 0.75rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 0.25rem;
            }

            .section-header h3 {
                font-size: 1.25rem;
                margin-bottom: 0.75rem;
            }

            .visualization-note {
                font-size: 0.8rem;
                padding: 0.5rem;
            }
            
            /* Insights mobile styles */
            .insights-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .insight-card {
                padding: 1.5rem;
            }
            
            .insight-card h3 {
                font-size: 1.25rem;
            }
            
            .insight-message {
                margin: 1rem 0;
            }
            
            .insight-message-content {
                padding: 1rem;
            }
            
            .insight-message h4 {
                font-size: 1.125rem;
            }
            
            /* Data quality indicator mobile styles */
            .data-quality-indicator {
                gap: 0.5rem;
                margin-top: 1rem;
            }
            
            .quality-badge {
                padding: 0.375rem 0.75rem;
                font-size: 0.75rem;
            }
        }
         
         .zoom-controls {
             position: absolute;
             top: 20px;
             right: 20px;
             display: flex;
             flex-direction: column;
             gap: 8px;
             z-index: 1000;
         }
         
         .zoom-btn {
             width: 40px;
             height: 40px;
             border: none;
             border-radius: 8px;
             background: rgba(255, 255, 255, 0.9);
             color: #2d3748;
             font-size: 18px;
             font-weight: bold;
             cursor: pointer;
             box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
             transition: all 0.2s ease;
             display: flex;
             align-items: center;
             justify-content: center;
         }
         
         .zoom-btn:hover {
             background: rgba(255, 255, 255, 1);
             transform: scale(1.05);
             box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
         }
         
         .zoom-btn:active {
             transform: scale(0.95);
         }

         .mobile-zoom .zoom-btn {
             width: 60px;
             height: 60px;
             font-size: 1.8rem;
             margin-bottom: 15px;
             -webkit-tap-highlight-color: transparent;
             touch-action: manipulation;
         }
         
         .world-map {
             cursor: grab;
         }
         
         .world-map:active {
             cursor: grabbing;
         }
         
         #countriesGroup {
             will-change: transform;
             transition: none;
             transform-origin: center;
         }
         
         .country {
             vector-effect: non-scaling-stroke;
             pointer-events: auto;
             cursor: pointer;
         }
         
         .world-map svg {
             backface-visibility: hidden;
             -webkit-backface-visibility: hidden;
             transform-origin: center;
         }

         /* Performance optimizations */
         .world-map {
             cursor: grab;
             -webkit-user-select: none;
             -moz-user-select: none;
             -ms-user-select: none;
             user-select: none;
         }
         
         .world-map:active {
             cursor: grabbing;
         }

         .world-map svg path {
             -webkit-tap-highlight-color: transparent;
             touch-action: manipulation;
             shape-rendering: optimizeSpeed;
         }

                 /* Performance optimizations for smooth interactions */
        .world-map svg {
            shape-rendering: optimizeSpeed;
            text-rendering: optimizeSpeed;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            /* Prevent flickering */
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        .world-map svg path {
            shape-rendering: geometricPrecision;
            vector-effect: non-scaling-stroke;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            /* Prevent flickering */
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            /* Smooth transitions */
            transition: fill 0.15s ease, stroke 0.15s ease;
        }

        /* Prevent flickering on small countries */
        .world-map svg path:hover {
            z-index: 5;
        }

        /* Optimize for small countries */
        .world-map svg path[data-country] {
            pointer-events: auto;
            cursor: pointer;
        }

                 /* Chrome-specific cursor handling */
        .world-map {
            cursor: grab !important;
            -webkit-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
            user-select: none !important;
            -webkit-touch-callout: none !important;
            -webkit-tap-highlight-color: transparent !important;
            /* Prevent cursor flickering */
            cursor: -webkit-grab;
            cursor: -moz-grab;
        }
        
        .world-map.grabbing {
            cursor: grabbing !important;
            cursor: -webkit-grabbing;
            cursor: -moz-grabbing;
        }

        /* Prevent cursor flickering on countries */
        .world-map svg path {
            cursor: pointer !important;
            cursor: -webkit-pointer;
            cursor: -moz-pointer;
        }

        /* Smooth cursor transitions */
        .world-map svg path:hover {
            cursor: pointer !important;
        }

         /* Chrome-specific drag handling */
         .world-map svg {
             -webkit-user-drag: none !important;
             -khtml-user-drag: none !important;
             -moz-user-drag: none !important;
             -o-user-drag: none !important;
             user-drag: none !important;
         }
         
         /* Mobile optimizations */
         @media (max-width: 768px) {
             .world-map {
                 height: 400px; /* Smaller height on mobile */
                 touch-action: pan-x pan-y; /* Enable touch panning */
                 -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
             }
             
             .zoom-controls {
                 top: 10px;
                 right: 10px;
                 gap: 6px;
             }
             
             .zoom-btn {
                 width: 36px;
                 height: 36px;
                 font-size: 18px;
                 min-height: 36px; /* Touch target size */
             }
         }
         
         @media (max-width: 480px) {
             .world-map {
                 height: 350px; /* Even smaller on very small screens */
             }
             
             .zoom-controls {
                 top: 8px;
                 right: 8px;
                 gap: 4px;
             }
             
             .zoom-btn {
                 width: 32px;
                 height: 32px;
                 font-size: 16px;
                 min-height: 32px;
             }
         }
         
         /* Touch device optimizations */
         @media (hover: none) and (pointer: coarse) {
             .world-map {
                 cursor: default; /* Remove cursor on touch devices */
             }
             
             .country {
                 min-height: 20px; /* Minimum touch target size */
             }
         }

         /* Smooth zoom controls */
                 .zoom-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            pointer-events: auto;
        }

        .zoom-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%);
            color: #1e40af;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            backdrop-filter: blur(10px);
        }

        .zoom-btn:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0.95) 100%);
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
        }

        .zoom-btn:active {
            transform: scale(0.95);
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .world-map {
                height: 400px;
            }
            
            .data-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Mobile-specific optimizations */
        .mobile-device .world-map {
            touch-action: pan-x pan-y;
            -webkit-overflow-scrolling: touch;
        }

        .mobile-device .country {
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .mobile-device .country:hover {
            stroke-width: 3px;
        }

        .mobile-device .data-panel {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .mobile-device .forecast-table {
            min-width: 600px;
        }

        .mobile-device .data-table {
            min-width: 500px;
        }

        /* Unified Indicator Section Styles */
        .indicator-section {
            margin-bottom: 2rem;
            border: 1px solid #cbd5e1;
            border-radius: 12px;
            padding: 1.5rem;
            background: #f8fafc;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .section-header h3 {
            margin: 0 0 1rem 0;
            color: #1e40af;
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-shadow: 0 1px 2px rgba(30, 64, 175, 0.1);
        }

        .visualization-note {
            font-size: 0.875rem;
            color: #475569;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: #e2e8f0;
            border-radius: 6px;
            border-left: 3px solid #1e40af;
            line-height: 1.5;
        }

        .current-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .indicator-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #ffffff;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }

        .indicator-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .indicator-label {
            font-weight: 500;
            color: #475569;
            font-size: 0.875rem;
        }

        .indicator-value {
            font-weight: 600;
            font-size: 0.875rem;
            color: #1a202c;
        }

        /* Enhanced Forecast Styles */
        .forecast-table-container {
            margin-bottom: 1.5rem;
            background: #ffffff;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .forecast-table-container h4 {
            color: #1e40af;
            font-size: 1.25rem;
            margin-bottom: 1rem;
            font-weight: 600;
            text-align: center;
        }

        .forecast-table {
            width: 100%;
            border-collapse: collapse;
            background: #f8fafc;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .forecast-table th,
        .forecast-table td {
            padding: 0.75rem;
            text-align: center;
            border-bottom: 1px solid #e2e8f0;
        }

        .forecast-table th {
            background: #e2e8f0;
            font-weight: 600;
            color: #475569;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .forecast-table td {
            color: #1a202c;
            font-size: 0.875rem;
        }

        .forecast-table tr:hover {
            background: #f1f5f9;
        }

        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .forecast-card {
            background: #ffffff;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }

        .forecast-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .forecast-card h4 {
            color: #1e40af;
            font-size: 1.125rem;
            margin-bottom: 1rem;
            font-weight: 600;
            text-align: center;
        }

        .forecast-value {
            text-align: center;
            margin-bottom: 1rem;
        }

        .forecast-year {
            display: block;
            font-size: 0.875rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        .forecast-main {
            display: block;
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 0.25rem;
        }

        .forecast-trend {
            text-align: center;
            font-size: 0.875rem;
            padding: 0.5rem;
            background: #e2e8f0;
            border-radius: 6px;
            color: #475569;
            margin-top: 0.5rem;
        }

        .forecast-methodology {
            background: #f1f5f9;
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 2rem;
            border-left: 4px solid #1e40af;
        }

        .forecast-methodology p {
            color: #475569;
            font-size: 0.875rem;
            line-height: 1.6;
            margin: 0;
        }

        .forecast-methodology strong {
            color: #1a202c;
            font-weight: 600;
        }

        /* Basic Top 5 Rankings */
        .top5-rankings {
            background: #3b82f6;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .top5-rankings strong {
            color: #fbbf24;
            font-weight: 600;
        }

        /* Basic Data Legend */
        .data-legend {
            background: #e2e8f0;
            padding: 0.75rem;
            border-radius: 6px;
            margin: 0.75rem 0;
            font-size: 0.875rem;
            color: #1a202c;
        }

        .data-legend span {
            margin-right: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 500;
        }

        .data-legend .real-data {
            background: #dcfce7;
            color: #166534;
        }

        .data-legend .projections {
            background: #e0e7ff;
            color: #3730a3;
        }

        .data-legend .not-available {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Enhanced Page System */
        .page {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 3rem 0;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px;
            border: 2px solid #cbd5e1;
        }

        .page-header h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(30, 64, 175, 0.1);
        }

        .page-header p {
            color: #475569;
            font-size: 1.25rem;
            font-weight: 500;
            line-height: 1.6;
        }

        /* Enhanced Data Explorer Styles */
        .data-categories {
            display: grid !important;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)) !important;
            gap: 2rem;
            margin-bottom: 3rem;
            min-height: 400px;
            border: 3px solid red !important;
            background: rgba(255, 0, 0, 0.1) !important;
        }
        
        /* Data Insights Styles */
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .insight-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .insight-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #06b6d4);
        }
        
        .insight-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border-color: #3b82f6;
        }
        
        .insight-header {
            margin-bottom: 1.5rem;
        }
        
        .insight-date {
            display: inline-block;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.75rem;
        }
        
        .insight-card h3 {
            color: #1e40af;
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 0 2px 4px rgba(30, 64, 175, 0.1);
        }
        
        .insight-card p {
            color: #475569;
            margin-bottom: 1.5rem;
            font-size: 1rem;
            line-height: 1.6;
        }
        
        .insight-metrics {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .metric {
            background: #f1f5f9;
            color: #475569;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .insight-btn {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .insight-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }
        
        .insight-btn:active {
            transform: translateY(0);
        }
        
        /* Insight Message Styles */
        .insight-message {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
            animation: slideInDown 0.5s ease-out;
        }
        
        .insight-message-content {
            padding: 1.5rem;
            position: relative;
        }
        
        .insight-message h4 {
            margin: 0 0 0.5rem 0;
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .insight-message p {
            margin: 0;
            opacity: 0.9;
            line-height: 1.5;
        }
        
        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.2s ease;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .category-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 2px solid blue !important;
            background: rgba(0, 0, 255, 0.1) !important;
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #1e40af, #3b82f6, #8b5cf6);
        }

        .category-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border-color: #1e40af;
        }

        .category-card h3 {
            color: #1e40af;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 0 1px 2px rgba(30, 64, 175, 0.1);
        }

        .category-card p {
            color: #475569;
            margin-bottom: 1.5rem;
            font-size: 1rem;
            line-height: 1.6;
        }

        .explore-btn {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(30, 64, 175, 0.3);
        }

        .explore-btn:hover {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(30, 64, 175, 0.4);
        }

        .explore-btn:active {
            transform: translateY(0);
        }

        /* Forecasts Page Styles */
        .forecast-overview {
            max-width: 800px;
            margin: 0 auto;
        }

        .forecast-intro {
            background: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border-left: 3px solid #1e40af;
        }

        .forecast-intro h3 {
            color: #1a202c;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .forecast-intro p {
            color: #475569;
            line-height: 1.6;
        }

        .forecast-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .metric-card {
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }

        .metric-card h4 {
            color: #1a202c;
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .metric-card p {
            color: #64748b;
            font-size: 0.875rem;
        }

        /* Comparisons Page Styles */
        .comparison-tools {
            max-width: 800px;
            margin: 0 auto;
        }

        .comparison-selector {
            background: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .comparison-selector h3 {
            color: #1a202c;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .country-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .country-select {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            background: #f1f5f9;
        }

        .compare-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
        }

        .compare-btn:hover {
            background: #2563eb;
        }

        .comparison-results {
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            padding: 1.5rem;
            min-height: 200px;
        }

        .comparison-results p {
            color: #64748b;
            text-align: center;
            margin: 0;
        }

        /* About Page Styles */
        .about-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .about-section {
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .about-section h3 {
            color: #1a202c;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .about-section p {
            color: #475569;
            line-height: 1.6;
            margin-bottom: 0.75rem;
        }

        .about-section ul {
            color: #475569;
            line-height: 1.6;
        }

        .about-section li {
            margin-bottom: 0.5rem;
        }







        /* Basic Mobile Styles */
        @media (max-width: 768px) {
            /* Improve touch interactions */
            .world-map {
                touch-action: pan-x pan-y;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }
            
            .world-map path {
                touch-action: manipulation;
                cursor: pointer;
            }
            
            /* Mobile zoom controls */
            .mobile-zoom .zoom-btn {
                width: 44px;
                height: 44px;
                font-size: 18px;
                border-radius: 22px;
            }
            
            /* Mobile data panel layout */
            .data-panel {
                margin: 0.5rem;
                padding: 0.75rem;
                max-height: 60vh;
                overflow-y: auto;
                position: relative;
                z-index: 1000;
            }
            
            /* Mobile header stats */
            .header-stats {
                gap: 0.5rem;
                margin-top: 0.75rem;
            }
            
            .stat-item {
                padding: 0.375rem;
                min-width: 60px;
                max-width: 80px;
            }
            
            .stat-number {
                font-size: 1rem;
                margin-bottom: 0.125rem;
            }
            
            .stat-label {
                font-size: 0.625rem;
            }
            
            /* Mobile map container */
            .map-container {
                height: 40vh;
                min-height: 300px;
            }
            
            /* Mobile world map */
            .world-map {
                height: 100%;
                position: relative;
                overflow: hidden;
            }
            
            /* Mobile SVG optimization */
            .world-map svg {
                width: 100%;
                height: 100%;
                touch-action: manipulation;
            }
            
            /* Mobile country paths */
            .world-map path {
                touch-action: manipulation;
                cursor: pointer;
                min-width: 20px;
                min-height: 20px;
            }
            
            /* Mobile navigation improvements */
            .navigation {
                padding: 0.5rem;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .nav-menu {
                gap: 0.5rem;
                padding: 0 0.5rem;
            }
            
            .nav-link {
                padding: 0.5rem 0.75rem;
                font-size: 0.875rem;
                white-space: nowrap;
            }
            
            /* Mobile page layout */
            .page {
                padding: 0.5rem;
            }
            
            /* Mobile category cards */
            .category-card {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            
            .category-card h3 {
                font-size: 1.1rem;
                margin-bottom: 0.5rem;
            }
            
            .category-card p {
                font-size: 0.875rem;
                line-height: 1.4;
            }
            
            .data-header h2 {
                font-size: 1.25rem;
                margin-bottom: 0.5rem;
            }
            
            .data-header p {
                font-size: 0.8rem;
                margin-bottom: 0.5rem;
            }
            
            /* Mobile indicator sections */
            .indicator-section {
                margin-bottom: 1rem;
                padding: 0.75rem;
            }
            
            .section-header h3 {
                font-size: 1.1rem;
                margin-bottom: 0.5rem;
            }
            
            .visualization-note {
                font-size: 0.75rem;
                padding: 0.5rem;
                margin-bottom: 0.5rem;
            }
            
            /* Mobile current indicators */
            .current-indicators {
                grid-template-columns: 1fr;
                gap: 0.5rem;
                margin-bottom: 0.75rem;
            }
            
            .indicator-item {
                padding: 0.5rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 0.25rem;
            }
            
            .indicator-label {
                font-size: 0.75rem;
                font-weight: 600;
            }
            
            .indicator-value {
                font-size: 0.875rem;
                font-weight: 700;
            }
            
            /* Mobile forecast tables */
            .forecast-table-container {
                padding: 0.75rem;
                margin-bottom: 0.75rem;
            }
            
            .forecast-table-container h4 {
                font-size: 1rem;
                margin-bottom: 0.5rem;
            }
            
            .forecast-table {
                font-size: 0.7rem;
            }
            
            .forecast-table th,
            .forecast-table td {
                padding: 0.25rem 0.125rem;
            }
            
            /* Mobile data tables */
            .data-table {
                font-size: 0.7rem;
            }
            
            .data-table th,
            .data-table td {
                padding: 0.25rem 0.125rem;
            }
            
            /* Mobile top5 rankings */
            .top5-rankings {
                font-size: 0.7rem;
                padding: 0.5rem;
                margin-top: 0.5rem;
        }
            .header h1 {
                font-size: 1.75rem;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            .header-stats {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-menu {
                flex-direction: column;
            }

            .nav-link {
                padding: 0.75rem 1rem;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .map-container,
            .data-panel {
                padding: 1rem;
            }
            
            .indicator-section {
                padding: 1rem;
            }
            
            .current-indicators {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .data-categories {
                grid-template-columns: 1fr;
                gap: 1rem;
                margin-bottom: 2rem;
            }

            .country-selector {
                flex-direction: column;
            }

            .page-header h2 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <header class="header">
            <div class="header-content">
                <div class="header-top">
                    <h1 id="main-title">🌍 World Data Map</h1>
                    <div class="language-selector">
                        <button class="lang-btn active" data-lang="en">🇺🇸 EN</button>
                        <button class="lang-btn" data-lang="fr">🇫🇷 FR</button>
                        <button class="lang-btn" data-lang="de">🇩🇪 DE</button>
                    </div>
                </div>
                <p id="main-description">Interactive visualization of comprehensive global indicators</p>
                
                <!-- Country Search Box -->
                <div class="search-container">
                    <div class="search-icon">🔍</div>
                    <input 
                        type="text" 
                        class="search-box search-box-with-icon" 
                        id="countrySearch" 
                        placeholder="Search for a country... (e.g., Japan, Brazil, Morocco)"
                        autocomplete="off"
                    >
                    <div class="search-results" id="searchResults"></div>
                </div>
                
                <div class="header-stats">
                    <div class="stat-item">
                        <span class="stat-number">195+</span>
                        <span class="stat-label" id="stat-countries">Countries</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">100+</span>
                        <span class="stat-label" id="stat-indicators">Indicators</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">10</span>
                        <span class="stat-label" id="stat-years">Years Data</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">8</span>
                        <span class="stat-label" id="stat-categories">Categories</span>
                    </div>
                </div>
            </div>
        </header>
        
        <nav class="navigation">
            <div class="nav-container">
                <ul class="nav-menu">
                    <li class="nav-item active">
                        <a href="#map" class="nav-link" data-page="map">
                            <span class="nav-icon">🗺️</span>
                            Interactive Map
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#data" class="nav-link" data-page="data">
                            <span class="nav-icon">📊</span>
                            Data Explorer
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#forecasts" class="nav-link" data-page="forecasts">
                            <span class="nav-icon">🔮</span>
                            Forecasts
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#comparisons" class="nav-link" data-page="comparisons">
                            <span class="nav-icon">⚖️</span>
                            Comparisons
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#insights" class="nav-link" data-page="insights">
                            <span class="nav-icon">💡</span>
                            Insights
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#about" class="nav-link" data-page="about">
                            <span class="nav-icon">ℹ️</span>
                            About
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
        
        <main class="main-content">
            <!-- Map Page -->
            <div class="page active" id="map-page">
                <div class="map-container">
                    <div class="map-header">
                        <h2>Interactive World Map</h2>
                        <p>Hover over countries to see names, click to view detailed data</p>
                    </div>
                    <div class="world-map" id="worldMap">
                        <div class="loading">
                            <div class="spinner"></div>
                            <span>Loading world map...</span>
                        </div>
                        
                        <!-- Zoom Controls -->
                        <div class="zoom-controls">
                            <button class="zoom-btn" onclick="zoomIn()" title="Zoom In">+</button>
                            <button class="zoom-btn" onclick="zoomOut()" title="Zoom Out">−</button>
                            <button class="zoom-btn" onclick="resetMap()" title="Reset Map">⌂</button>
                        </div>
                    </div>
                </div>
                
                <div class="data-panel" id="dataPanel">
                    <div class="data-header">
                        <h2>Comprehensive Data Panel</h2>
                    </div>
                    <div class="no-selection">
                        <p>👆 Click on any country on the map above to view its comprehensive data</p>
                        <p>Data includes economic, social, environmental, and technology indicators for the last 10 years</p>
                        <div class="data-quality-indicator">
                            <span class="quality-badge">📊 High-Quality Data</span>
                            <span class="quality-badge">🔍 Multi-Source Validation</span>
                            <span class="quality-badge">📈 Real-Time Updates</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Explorer Page -->
            <div class="page" id="data-page">
                <div class="page-header">
                    <h2>📊 Data Explorer</h2>
                    <p>Explore global data by category and indicator</p>
                </div>
                
                <div class="data-categories">
                    <div class="category-card">
                        <h3>🌍 Economic Indicators</h3>
                        <p>GDP, growth rates, inflation, trade data, poverty rates, inequality measures</p>
                        <button class="explore-btn" onclick="showCategoryData('economic')">Explore Data</button>
                    </div>
                    
                    <div class="category-card">
                        <h3>👥 Social & Demographics</h3>
                        <p>Population, education, health, life expectancy, migration, urbanization</p>
                        <button class="explore-btn" onclick="showCategoryData('social')">Explore Data</button>
                    </div>
                    
                    <div class="category-card">
                        <h3>🌱 Energy & Environment</h3>
                        <p>CO₂ emissions, renewable energy, deforestation, air quality, biodiversity</p>
                        <button class="explore-btn" onclick="showCategoryData('environmental')">Explore Data</button>
                    </div>
                    
                    <div class="category-card">
                        <h3>💡 Technology & Innovation</h3>
                        <p>Internet penetration, patents, R&D spending, AI development, digital adoption</p>
                        <button class="explore-btn" onclick="showCategoryData('technology')">Explore Data</button>
                    </div>
                    
                    <div class="category-card">
                        <h3>🏛️ Democracy & Governance</h3>
                        <p>Political systems, human rights, corruption levels, press freedom, rule of law</p>
                        <button class="explore-btn" onclick="showCategoryData('democracy')">Explore Data</button>
                    </div>
                    
                    <div class="category-card">
                        <h3>🏠 Living Conditions</h3>
                        <p>Housing quality, infrastructure, access to basic services, quality of life</p>
                        <button class="explore-btn" onclick="showCategoryData('living')">Explore Data</button>
                    </div>
                    
                    <div class="category-card">
                        <h3>🌾 Food & Agriculture</h3>
                        <p>Agricultural productivity, food security, nutrition, farming systems</p>
                        <button class="explore-btn" onclick="showCategoryData('agriculture')">Explore Data</button>
                    </div>
                    
                    <div class="category-card">
                        <h3>⚔️ Peace & Security</h3>
                        <p>Conflict data, military spending, terrorism, peace indices, human security</p>
                        <button class="explore-btn" onclick="showCategoryData('security')">Explore Data</button>
                    </div>
                </div>
            </div>

            <!-- Forecasts Page -->
            <div class="page" id="forecasts-page">
                <div class="page-header">
                    <h2>🔮 Economic Forecasts</h2>
                    <p>5-year projections and trend analysis</p>
                </div>
                
                <div class="forecast-overview">
                    <div class="forecast-intro">
                        <h3>Forecasting Methodology</h3>
                        <p>Our forecasts use statistical analysis of historical data to project future trends. We combine linear regression, moving averages, and CAGR calculations to provide reliable projections with confidence intervals.</p>
                    </div>
                    
                    <div class="forecast-metrics">
                        <div class="metric-card">
                            <h4>GDP Growth</h4>
                            <p>Projected annual growth rates</p>
                        </div>
                        <div class="metric-card">
                            <h4>Population Trends</h4>
                            <p>Demographic projections</p>
                        </div>
                        <div class="metric-card">
                            <h4>Inflation Outlook</h4>
                            <p>Price stability forecasts</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comparisons Page -->
            <div class="page" id="comparisons-page">
                <div class="page-header">
                    <h2>⚖️ Country Comparisons</h2>
                    <p>Compare countries across different indicators</p>
                </div>
                
                <div class="comparison-tools">
                    <div class="comparison-selector">
                        <h3>Select Countries to Compare</h3>
                        <div class="country-selector">
                            <select id="country1" class="country-select">
                                <option value="">Select first country...</option>
                            </select>
                            <select id="country2" class="country-select">
                                <option value="">Select second country...</option>
                            </select>
                        </div>
                        <button class="compare-btn" onclick="compareCountries()">Compare Countries</button>
                    </div>
                    
                    <div class="comparison-results" id="comparisonResults">
                        <p>Select two countries above to see a detailed comparison</p>
                    </div>
                </div>
            </div>

            <!-- Data Insights Page -->
            <div class="page" id="insights-page">
                <div class="page-header">
                    <h2>💡 Data Insights</h2>
                    <p>Bite-sized insights on how the world is changing, updated regularly</p>
                </div>
                
                <div class="insights-grid">
                    <div class="insight-card">
                        <div class="insight-header">
                            <span class="insight-date">Latest</span>
                            <h3>🌍 Global Poverty Reduction</h3>
                        </div>
                        <p>The world has made remarkable progress in reducing extreme poverty. Since 1990, over 1 billion people have escaped extreme poverty, with the global poverty rate falling from 36% to less than 10%.</p>
                        <div class="insight-metrics">
                            <span class="metric">📊 1B+ people lifted out of poverty</span>
                            <span class="metric">📈 26% reduction in 30 years</span>
                        </div>
                        <button class="insight-btn" onclick="exploreInsight('poverty')">Explore Data</button>
                    </div>
                    
                    <div class="insight-card">
                        <div class="insight-header">
                            <span class="insight-date">Trending</span>
                            <h3>⚡ Renewable Energy Growth</h3>
                        </div>
                        <p>Renewable energy capacity has grown exponentially worldwide. Solar and wind power now account for over 80% of new electricity generation capacity, marking a fundamental shift in global energy systems.</p>
                        <div class="insight-metrics">
                            <span class="metric">☀️ 80%+ of new capacity</span>
                            <span class="metric">📈 Exponential growth trend</span>
                        </div>
                        <button class="insight-btn" onclick="exploreInsight('renewables')">Explore Data</button>
                    </div>
                    
                    <div class="insight-card">
                        <div class="insight-header">
                            <span class="insight-date">Analysis</span>
                            <h3>🎓 Global Education Progress</h3>
                        </div>
                        <p>Global literacy rates have improved dramatically, with primary school enrollment reaching 91% worldwide. However, significant gaps remain in secondary and tertiary education access between regions.</p>
                        <div class="insight-metrics">
                            <span class="metric">📚 91% primary enrollment</span>
                            <span class="metric">🌍 Regional disparities persist</span>
                        </div>
                        <button class="insight-btn" onclick="exploreInsight('education')">Explore Data</button>
                    </div>
                    
                    <div class="insight-card">
                        <div class="insight-header">
                            <span class="insight-date">Research</span>
                            <h3>🏥 Healthcare Access Improvements</h3>
                        </div>
                        <p>Global life expectancy has increased by over 20 years since 1950, driven by improvements in healthcare, nutrition, and disease prevention. Child mortality rates have fallen by 60% since 1990.</p>
                        <div class="insight-metrics">
                            <span class="metric">⏰ +20 years life expectancy</span>
                            <span class="metric">👶 60% child mortality reduction</span>
                        </div>
                        <button class="insight-btn" onclick="exploreInsight('healthcare')">Explore Data</button>
                    </div>
                </div>
            </div>

            <!-- About Page -->
            <div class="page" id="about-page">
                <div class="page-header">
                    <h2>ℹ️ About World Data Map</h2>
                    <p>Learn about our data sources and methodology</p>
                </div>
                
                <div class="about-content">
                    <div class="about-section">
                        <h3>Our Mission</h3>
                        <p>World Data Map provides comprehensive, real-time global data visualization to help users understand global development trends and make informed decisions. We believe that data-driven insights are essential for understanding our world and making informed decisions.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>Data Sources</h3>
                        <ul>
                            <li><strong>World Bank</strong> - Economic and development indicators</li>
                            <li><strong>IMF</strong> - Economic projections and forecasts</li>
                            <li><strong>UNESCO</strong> - Education and cultural data</li>
                            <li><strong>WHO</strong> - Health and life expectancy data</li>
                            <li><strong>OWID/EDGAR</strong> - Environmental and CO₂ data</li>
                            <li><strong>OECD</strong> - High-income country statistics</li>
                            <li><strong>UN FAO</strong> - Agricultural and food security data</li>
                            <li><strong>IEA</strong> - Energy and climate statistics</li>
                        </ul>
                    </div>
                    
                    <div class="about-section">
                        <h3>Data Quality & Methodology</h3>
                        <p>We prioritize data quality and transparency. All indicators include source information, update frequency, and confidence levels. Missing data is clearly marked, and we provide context for data limitations. Our methodology follows rigorous standards, combining multiple sources for validation.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>Technology</h3>
                        <p>Built with modern web technologies including D3.js for data visualization, responsive design for all devices, and real-time API integration. We use the same visualization techniques as leading data organizations like Our World in Data.</p>
                    </div>
                    
                    <div class="about-section">
                        <h3>Open Access</h3>
                        <p>Like Our World in Data, we believe in open access to knowledge. All our visualizations, data, and insights are freely available for research, education, and public use. We're committed to making global data accessible to everyone.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Navigation system
        function initNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            const pages = document.querySelectorAll('.page');
            let mapInitialized = false;

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // Remove active class from all nav items and pages
                    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                    pages.forEach(page => page.classList.remove('active'));
                    
                    // Add active class to clicked nav item
                    link.parentElement.classList.add('active');
                    
                    // Show corresponding page
                    const targetPage = link.getAttribute('data-page');
                    console.log('Navigation clicked:', targetPage);
                    const targetPageElement = document.getElementById(targetPage + '-page');
                    if (targetPageElement) {
                        targetPageElement.classList.add('active');
                        console.log('Page activated:', targetPageElement.id);
                    } else {
                        console.error('Page not found:', targetPage + '-page');
                    }
                    
                    // Only initialize map once when map page is first shown
                    if (targetPage === 'map' && !mapInitialized) {
                        mapInitialized = true;
                        // Small delay to ensure page is visible
                        setTimeout(() => {
                            if (!document.querySelector('.world-map svg')) {
                                initWorldMap();
                            }
                        }, 100);
                    }
                });
            });
        }

        // Page-specific functions
        function showCategoryData(category) {
            // This would show detailed data for the selected category
            alert(`Showing ${category} data. This feature would display detailed indicators for the selected category.`);
        }
        
        // Function to explore insights
        function exploreInsight(insightType) {
            console.log('Exploring insight:', insightType);
            
            // Switch to map page and show relevant data
            showPage('map');
            
            // Show success message
            showInsightMessage(insightType);
            
            // You can add specific logic for each insight type
            switch(insightType) {
                case 'poverty':
                    // Could highlight countries with poverty data
                    break;
                case 'renewables':
                    // Could highlight countries with renewable energy data
                    break;
                case 'education':
                    // Could highlight countries with education data
                    break;
                case 'healthcare':
                    // Could highlight countries with healthcare data
                    break;
            }
        }
        
        // Function to show insight exploration message
        function showInsightMessage(insightType) {
            const insightNames = {
                'poverty': 'Global Poverty Reduction',
                'renewables': 'Renewable Energy Growth',
                'education': 'Global Education Progress',
                'healthcare': 'Healthcare Access Improvements'
            };
            
            const message = document.createElement('div');
            message.className = 'insight-message';
            message.innerHTML = `
                <div class="insight-message-content">
                    <h4>💡 Exploring: ${insightNames[insightType]}</h4>
                    <p>Use the map above to explore countries and their data related to this topic.</p>
                    <button onclick="this.parentElement.parentElement.remove()" class="close-btn">×</button>
                </div>
            `;
            
            // Add to the top of the map page
            const mapPage = document.getElementById('map-page');
            mapPage.insertBefore(message, mapPage.firstChild);
            
            // Auto-remove after 8 seconds
            setTimeout(() => {
                if (message.parentElement) {
                    message.remove();
                }
            }, 8000);
        }
        
        // Function to show pages (for navigation)
        function showPage(pageName) {
            console.log('Switching to page:', pageName);
            
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
                console.log('Hiding page:', page.id);
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show target page
            const targetPage = document.getElementById(pageName + '-page');
            if (targetPage) {
                targetPage.classList.add('active');
                console.log('Showing page:', targetPage.id);
                
                // Debug: Check if categories are visible
                if (pageName === 'data') {
                    const categories = targetPage.querySelector('.data-categories');
                    const categoryCards = targetPage.querySelectorAll('.category-card');
                    console.log('Categories container:', categories);
                    console.log('Number of category cards:', categoryCards.length);
                    categoryCards.forEach((card, index) => {
                        console.log(`Category ${index + 1}:`, card.querySelector('h3').textContent);
                    });
                }
            } else {
                console.error('Target page not found:', pageName + '-page');
            }
            
            // Add active class to corresponding nav item
            const navLink = document.querySelector(`[data-page="${pageName}"]`);
            if (navLink) {
                navLink.parentElement.classList.add('active');
            }
        }

        function compareCountries() {
            const country1 = document.getElementById('country1').value;
            const country2 = document.getElementById('country2').value;
            const resultsDiv = document.getElementById('comparisonResults');
            
            if (!country1 || !country2) {
                alert('Please select both countries to compare.');
                return;
            }
            
            if (country1 === country2) {
                alert('Please select different countries to compare.');
                return;
            }
            
            // This would fetch and display comparison data
            resultsDiv.innerHTML = `
                <h3>Comparing ${country1} vs ${country2}</h3>
                <p>This feature would display a detailed side-by-side comparison of key indicators between the two countries.</p>
                <div class="comparison-table">
                    <p>Comparison data would be loaded here...</p>
                </div>
            `;
        }

        function populateCountryDropdowns() {
            const countries = [
                'United States', 'China', 'Japan', 'Germany', 'United Kingdom',
                'France', 'India', 'Italy', 'Canada', 'Brazil', 'Russia', 'Australia',
                'Spain', 'Mexico', 'Indonesia', 'Netherlands', 'Saudi Arabia',
                'Turkey', 'Switzerland', 'Poland', 'Sweden', 'Belgium', 'Thailand',
                'Austria', 'Norway', 'United Arab Emirates', 'Iran', 'Israel',
                'Denmark', 'Singapore', 'Malaysia', 'Egypt', 'Philippines',
                'Finland', 'Chile', 'Colombia', 'South Africa', 'Pakistan',
                'Greece', 'Portugal', 'New Zealand', 'Peru', 'Czech Republic',
                'Romania', 'Vietnam', 'Bangladesh', 'Hungary', 'Ukraine',
                'Morocco', 'Slovakia', 'Croatia', 'Bulgaria', 'Tunisia'
            ];
            
            const country1Select = document.getElementById('country1');
            const country2Select = document.getElementById('country2');
            
            countries.forEach(country => {
                const option1 = new Option(country, country);
                const option2 = new Option(country, country);
                country1Select.add(option1);
                country2Select.add(option2);
            });
        }

        // Language translations
        const translations = {
            en: {
                mainTitle: "🌍 World Data Map",
                mainDescription: "Interactive visualization of comprehensive global indicators",
                statCountries: "Countries",
                statIndicators: "Indicators", 
                statYears: "Years Data",
                statCategories: "Categories",
                mapTitle: "Interactive World Map",
                mapDescription: "Click on any country to explore detailed data",
                dataPanelTitle: "Comprehensive Data Panel",
                noSelectionText: "👆 Click on any country on the map above to view its comprehensive data",
                noSelectionSubtext: "Data includes economic, social, environmental, and technology indicators for the last 10 years",
                economicIndicators: "📊 Economic Indicators",
                socialIndicators: "👥 Society & Demographics", 
                environmentalIndicators: "🌍 Energy & Environment",
                technologyIndicators: "💡 Technology & Innovation",
                derivedMetrics: "🧮 Derived Metrics & Analytics",
                forecasting: "🔮 5-Year Forecasts",
                dataSummary: "📊 Data Summary",
                loadingText: "Loading world map...",
                loadingMapText: "Loading map data...",
                loadingWorldMapText: "Loading world map data...",
                forecastMethodology: "Methodology: Forecasts use linear regression on 5-year trends with 95% confidence intervals. Projections are marked with 🔮 and include source information. Actual results may vary due to economic shocks, policy changes, and external factors.",
                dataLegend: "Data Legend:",
                realData: "🟢 Real API Data",
                projections: "🔮 IMF Projections",
                notAvailable: "🔴 Not Available",
                top5GDP: "🏆 Top 5 GDP:",
                top5LifeExpectancy: "🏆 Top 5 Life Expectancy:",
                top5Renewable: "🏆 Top 5 Renewable Energy:",
                top5RND: "🏆 Top 5 R&D Spending:",
                gdpSummary: "GDP Summary",
                inflationSummary: "Inflation Summary",
                populationSummary: "Population Summary",
                fiveYearGrowth: "5-Year Growth:",
                averageRate: "Average Rate:",
                growingTrend: "📈 Growing trend",
                decliningTrend: "📉 Declining trend",
                decreasingTrend: "📉 Decreasing trend",
                increasingTrend: "📈 Increasing trend"
            },
            fr: {
                mainTitle: "🌍 Carte des Données Mondiales",
                mainDescription: "Visualisation interactive d'indicateurs globaux complets",
                statCountries: "Pays",
                statIndicators: "Indicateurs",
                statYears: "Années de Données",
                statCategories: "Catégories",
                mapTitle: "Carte du Monde Interactive",
                mapDescription: "Cliquez sur un pays pour explorer les données détaillées",
                dataPanelTitle: "Panneau de Données Complet",
                noSelectionText: "👆 Cliquez sur un pays sur la carte ci-dessus pour voir ses données complètes",
                noSelectionSubtext: "Les données incluent des indicateurs économiques, sociaux, environnementaux et technologiques pour les 10 dernières années",
                economicIndicators: "📊 Indicateurs Économiques",
                socialIndicators: "👥 Société & Démographie",
                environmentalIndicators: "🌍 Énergie & Environnement", 
                technologyIndicators: "💡 Technologie & Innovation",
                derivedMetrics: "🧮 Métriques Dérivées & Analyses",
                forecasting: "🔮 Prévisions sur 5 Ans",
                dataSummary: "📊 Résumé des Données",
                loadingText: "Chargement de la carte du monde...",
                loadingMapText: "Chargement des données de la carte...",
                loadingWorldMapText: "Chargement des données de la carte du monde...",
                forecastMethodology: "Méthodologie : Les prévisions utilisent la régression linéaire sur les tendances de 5 ans avec des intervalles de confiance de 95%. Les projections sont marquées avec 🔮 et incluent les informations de source. Les résultats réels peuvent varier en raison de chocs économiques, de changements de politique et de facteurs externes.",
                dataLegend: "Légende des Données :",
                realData: "🟢 Données API Réelles",
                projections: "🔮 Projections FMI",
                notAvailable: "🔴 Non Disponible",
                top5GDP: "🏆 Top 5 PIB :",
                top5LifeExpectancy: "🏆 Top 5 Espérance de Vie :",
                top5Renewable: "🏆 Top 5 Énergie Renouvelable :",
                top5RND: "🏆 Top 5 Dépenses R&D :",
                gdpSummary: "Résumé PIB",
                inflationSummary: "Résumé Inflation",
                populationSummary: "Résumé Population",
                fiveYearGrowth: "Croissance 5 Ans :",
                averageRate: "Taux Moyen :",
                growingTrend: "📈 Tendance croissante",
                decliningTrend: "📉 Tendance décroissante",
                decreasingTrend: "📉 Tendance décroissante",
                increasingTrend: "📈 Tendance croissante"
            },
            de: {
                mainTitle: "🌍 Weltdaten-Karte",
                mainDescription: "Interaktive Visualisierung umfassender globaler Indikatoren",
                statCountries: "Länder",
                statIndicators: "Indikatoren",
                statYears: "Jahre Daten",
                statCategories: "Kategorien",
                mapTitle: "Interaktive Weltkarte",
                mapDescription: "Klicken Sie auf ein Land, um detaillierte Daten zu erkunden",
                dataPanelTitle: "Umfassendes Datenpanel",
                noSelectionText: "👆 Klicken Sie auf ein Land auf der Karte oben, um seine umfassenden Daten anzuzeigen",
                noSelectionSubtext: "Daten umfassen wirtschaftliche, soziale, umweltbezogene und technologische Indikatoren für die letzten 10 Jahre",
                economicIndicators: "📊 Wirtschaftsindikatoren",
                socialIndicators: "👥 Gesellschaft & Demographie",
                environmentalIndicators: "🌍 Energie & Umwelt",
                technologyIndicators: "💡 Technologie & Innovation",
                derivedMetrics: "🧮 Abgeleitete Metriken & Analysen",
                forecasting: "🔮 5-Jahres-Prognosen",
                dataSummary: "📊 Datenzusammenfassung",
                loadingText: "Weltkarte wird geladen...",
                loadingMapText: "Kartendaten werden geladen...",
                loadingWorldMapText: "Weltkartendaten werden geladen...",
                forecastMethodology: "Methodik: Prognosen verwenden lineare Regression auf 5-Jahres-Trends mit 95%-Konfidenzintervallen. Projektionen sind mit 🔮 markiert und enthalten Quelleninformationen. Tatsächliche Ergebnisse können aufgrund von Wirtschaftsschocks, politischen Änderungen und externen Faktoren variieren.",
                dataLegend: "Datenlegende:",
                realData: "🟢 Echte API-Daten",
                projections: "🔮 IWF-Projektionen",
                notAvailable: "🔴 Nicht Verfügbar",
                top5GDP: "🏆 Top 5 BIP:",
                top5LifeExpectancy: "🏆 Top 5 Lebenserwartung:",
                top5Renewable: "🏆 Top 5 Erneuerbare Energie:",
                top5RND: "🏆 Top 5 F&E-Ausgaben:",
                gdpSummary: "BIP-Zusammenfassung",
                inflationSummary: "Inflationszusammenfassung",
                populationSummary: "Bevölkerungszusammenfassung",
                fiveYearGrowth: "5-Jahres-Wachstum:",
                averageRate: "Durchschnittsrate:",
                growingTrend: "📈 Wachsende Tendenz",
                decliningTrend: "📉 Fallende Tendenz",
                decreasingTrend: "📉 Abnehmende Tendenz",
                increasingTrend: "📈 Zunehmende Tendenz"
            }
        };

        let currentLanguage = 'en';

        function updateLanguage(lang) {
            currentLanguage = lang;
            const t = translations[lang];
            
            // Update header elements
            document.getElementById('main-title').textContent = t.mainTitle;
            document.getElementById('main-description').textContent = t.mainDescription;
            document.getElementById('stat-countries').textContent = t.statCountries;
            document.getElementById('stat-indicators').textContent = t.statIndicators;
            document.getElementById('stat-years').textContent = t.statYears;
            document.getElementById('stat-categories').textContent = t.statCategories;
            
            // Update map header
            const mapTitle = document.querySelector('.map-header h2');
            if (mapTitle) mapTitle.textContent = t.mapTitle;
            
            const mapDesc = document.querySelector('.map-header p');
            if (mapDesc) mapDesc.textContent = t.mapDescription;
            
            // Update data panel
            const dataPanelTitle = document.querySelector('.data-header h2');
            if (dataPanelTitle) dataPanelTitle.textContent = t.dataPanelTitle;
            
            const noSelectionText = document.querySelector('.no-selection p:first-child');
            if (noSelectionText) noSelectionText.textContent = t.noSelectionText;
            
            const noSelectionSubtext = document.querySelector('.no-selection p:last-child');
            if (noSelectionSubtext) noSelectionSubtext.textContent = t.noSelectionSubtext;
            
            // Update section headers
            const allH3s = document.querySelectorAll('h3');
            allH3s.forEach(header => {
                const text = header.textContent;
                if (text.includes('Economic Indicators')) {
                    header.textContent = t.economicIndicators;
                } else if (text.includes('Society & Demographics')) {
                    header.textContent = t.socialIndicators;
                } else if (text.includes('Energy & Environment')) {
                    header.textContent = t.environmentalIndicators;
                } else if (text.includes('Technology & Innovation')) {
                    header.textContent = t.technologyIndicators;
                } else if (text.includes('5-Year Forecasts')) {
                    header.textContent = t.forecasting;
                } else if (text.includes('Data Summary')) {
                    header.textContent = t.dataSummary;
                }
            });
            
            // Update forecast methodology
            const forecastMethodology = document.querySelector('.forecast-methodology p');
            if (forecastMethodology) forecastMethodology.innerHTML = t.forecastMethodology;
            
            // Update data legend text
            const dataLegendElements = document.querySelectorAll('.data-legend strong');
            dataLegendElements.forEach(element => {
                if (element.textContent.includes('Data Legend:')) {
                    element.textContent = t.dataLegend;
                }
            });
            
            // Update top 5 rankings
            const top5Rankings = document.querySelectorAll('.top5-rankings strong');
            top5Rankings.forEach(strong => {
                const text = strong.textContent;
                if (text.includes('Top 5 GDP')) {
                    strong.textContent = t.top5GDP;
                } else if (text.includes('Top 5 Life Expectancy')) {
                    strong.textContent = t.top5LifeExpectancy;
                } else if (text.includes('Top 5 Renewable Energy')) {
                    strong.textContent = t.top5Renewable;
                } else if (text.includes('Top 5 R&D Spending')) {
                    strong.textContent = t.top5RND;
                }
            });
            
            // Update forecast summary cards
            const forecastCards = document.querySelectorAll('.forecast-card h4');
            forecastCards.forEach(card => {
                const text = card.textContent;
                if (text.includes('GDP Summary')) {
                    card.textContent = t.gdpSummary;
                } else if (text.includes('Inflation Summary')) {
                    card.textContent = t.inflationSummary;
                } else if (text.includes('Population Summary')) {
                    card.textContent = t.populationSummary;
                }
            });
            
            // Update active language button
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
        }

        // Map Navigation System
        let mapX = 0;
        let mapY = 0;
        let mapZoom = 1.2;
        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let lastDragX = 0;
        let lastDragY = 0;
        
        // Touch support
        let isTouching = false;
        let touchStartX = 0;
        let touchStartY = 0;
        let lastTouchX = 0;
        let lastTouchY = 0;
        
        // Transform update function
        function updateMapTransform() {
            const countriesGroup = document.getElementById('countriesGroup');
            if (countriesGroup) {
                countriesGroup.style.transform = `translate3d(${mapX}px, ${mapY}px, 0) scale(${mapZoom})`;
            }
        }
        
        // Reset map to center
        function resetMap() {
            mapX = 0;
            mapY = 0;
            mapZoom = 1.2;
            updateMapTransform();
        }
        
        // Zoom in function
        function zoomIn() {
            mapZoom = Math.min(mapZoom * 1.2, 3.0);
            updateMapTransform();
        }
        
        // Zoom out function
        function zoomOut() {
            mapZoom = Math.max(mapZoom / 1.2, 0.5);
            updateMapTransform();
        }
        
        // Mobile detection
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
                   (window.innerWidth <= 768);
        }
        
        // Mobile settings
        function initMobileOptimizations() {
            if (isMobileDevice()) {
                // Adjust map height for mobile
                const worldMap = document.querySelector('.world-map');
                if (worldMap) {
                    if (window.innerWidth <= 480) {
                        worldMap.style.height = '350px';
                    } else {
                        worldMap.style.height = '400px';
                    }
                }
                
                // Mobile zoom controls
                const zoomControls = document.querySelector('.zoom-controls');
                if (zoomControls) {
                    zoomControls.classList.add('mobile-zoom');
                }
            }
        }

        // Mobile optimization function
        function initMobileOptimizations() {
            if (window.innerWidth <= 768) {
                // Add mobile-specific classes
                document.body.classList.add('mobile-device');
                
                // Optimize touch interactions
                const worldMap = document.querySelector('.world-map');
                if (worldMap) {
                    worldMap.classList.add('mobile-map');
                }
                
                // Add mobile zoom controls
                const zoomControls = document.querySelector('.zoom-controls');
                if (zoomControls) {
                    zoomControls.classList.add('mobile-zoom');
                }
            }
        }

        // Language selector event listeners
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const lang = e.target.dataset.lang;
                    updateLanguage(lang);
                });
            });

            // Data source selector event listeners
            document.querySelectorAll('input[name="dataSource"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    // Update the data panel header to reflect the selected source
                    const dataPanel = document.getElementById('dataPanel');
                    if (dataPanel.innerHTML.includes('Comprehensive Data for')) {
                        const currentCountry = dataPanel.querySelector('.country-name')?.textContent;
                        if (currentCountry) {
                            const dataSource = e.target.value;
                            if (dataSource === 'real') {
                                dataPanel.querySelector('.data-header p').innerHTML = 
                                    '📊 Real data from World Bank API • Last updated: ' + new Date().toLocaleDateString();
                            } else {
                                dataPanel.querySelector('.data-header p').innerHTML = 
                                    '🎲 Generated demo data for demonstration purposes';
                            }
                        }
                    }
                });
            });

                        // Map Event Listeners
            const worldMap = document.querySelector('.world-map');
            if (worldMap) {
                // Mouse events
                worldMap.addEventListener('mousedown', handleMouseDown, { passive: false });
                worldMap.addEventListener('mousemove', handleMouseMove, { passive: false });
                worldMap.addEventListener('mouseup', handleMouseUp, { passive: true });
                worldMap.addEventListener('mouseleave', handleMouseLeave, { passive: true });
                
                // Touch events - ensure they're added
                worldMap.addEventListener('touchstart', handleTouchStart, { passive: false });
                worldMap.addEventListener('touchmove', handleTouchMove, { passive: false });
                worldMap.addEventListener('touchend', handleTouchEnd, { passive: true });
                
                // Event prevention
                worldMap.addEventListener('dragstart', (e) => e.preventDefault(), { passive: false });
                worldMap.addEventListener('selectstart', (e) => e.preventDefault(), { passive: false });
                worldMap.addEventListener('contextmenu', (e) => e.preventDefault(), { passive: false });
                
                // Debug touch events
                console.log('Touch events added to worldMap:', worldMap);
                console.log('Touch event handlers:', { handleTouchStart, handleTouchMove, handleTouchEnd });
            }
            
            // Global mouse events
            document.addEventListener('mousemove', handleMouseMove, { passive: false });
            document.addEventListener('mouseup', handleMouseUp, { passive: true });
            
            // Prevent double-tap zoom
            let lastTouchEnd = 0;
            document.addEventListener('touchend', (event) => {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        });

        // Mouse Event Handlers
        function handleMouseDown(e) {
            if (e.button === 0) { // Left click only
                isDragging = true;
                dragStartX = e.clientX;
                dragStartY = e.clientY;
                lastDragX = mapX;
                lastDragY = mapY;
                e.preventDefault();
                
                // Change cursor
                const worldMap = document.querySelector('.world-map');
                if (worldMap) {
                    worldMap.classList.add('grabbing');
                }
            }
        }

        function handleMouseMove(e) {
            if (isDragging) {
                const deltaX = e.clientX - dragStartX;
                const deltaY = e.clientY - dragStartY;
                
                // Movement with bounds
                mapX = lastDragX + deltaX;
                mapX = Math.max(-500, Math.min(500, mapX));
                mapY = lastDragY + deltaY;
                mapY = Math.max(-300, Math.min(300, mapY));
                
                updateMapTransform();
                e.preventDefault();
            }
        }

        function handleMouseUp(e) {
            if (isDragging) {
                isDragging = false;
                
                // Update cursor
                const worldMap = document.querySelector('.world-map');
                if (worldMap) {
                    worldMap.classList.remove('grabbing');
                }
            }
        }

        function handleMouseLeave(e) {
            if (isDragging) {
                isDragging = false;
                
                // Update cursor
                const worldMap = document.querySelector('.world-map');
                if (worldMap) {
                    worldMap.classList.remove('grabbing');
                }
            }
        }
        
        // Touch Event Handlers
        let touchStartTime = 0;
        let touchMoved = false;

        function handleTouchStart(e) {
            if (e.touches.length === 1) {
                isTouching = true;
                touchStartTime = Date.now();
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                lastTouchX = mapX;
                lastTouchY = mapY;
                touchMoved = false;
                e.preventDefault();
            }
        }

        function handleTouchMove(e) {
            if (isTouching && e.touches.length === 1) {
                const touchX = e.touches[0].clientX;
                const touchY = e.touches[0].clientY;
                
                const deltaX = Math.abs(touchX - touchStartX);
                const deltaY = Math.abs(touchY - touchStartY);
                
                // If touch moved more than 10px, consider it a pan gesture
                if (deltaX > 10 || deltaY > 10) {
                    touchMoved = true;
                    
                    // Touch movement with bounds
                    mapX = lastTouchX + (touchX - touchStartX);
                    mapY = lastTouchY + (touchY - touchStartY);
                    
                    // Apply bounds
                    mapX = Math.max(-500, Math.min(500, mapX));
                    mapY = Math.max(-300, Math.min(300, mapY));
                    
                    updateMapTransform();
                }
                e.preventDefault();
            }
        }

        function handleTouchEnd(e) {
            if (isTouching && !touchMoved) {
                // This was a tap, not a pan - find the country under the touch point
                const touchX = e.changedTouches[0].clientX;
                const touchY = e.changedTouches[0].clientY;
                
                // Check if it's a quick tap (less than 300ms)
                const touchDuration = Date.now() - touchStartTime;
                if (touchDuration < 300) {
                    // Find the country path under the touch point
                    const elementUnderTouch = document.elementFromPoint(touchX, touchY);
                    if (elementUnderTouch && elementUnderTouch.tagName === 'path') {
                        // Add visual feedback for mobile users
                        const originalFill = elementUnderTouch.style.fill;
                        elementUnderTouch.style.fill = '#FFD700'; // Gold highlight
                        
                        // Remove highlight after 200ms
                        setTimeout(() => {
                            elementUnderTouch.style.fill = originalFill;
                        }, 200);
                        
                        // Simulate a click on the country
                        const clickEvent = new MouseEvent('click', {
                            bubbles: true,
                            cancelable: true,
                            view: window
                        });
                        elementUnderTouch.dispatchEvent(clickEvent);
                    }
                }
            }
            
            isTouching = false;
            touchMoved = false;
        }



                // Fetch real economic data from World Bank API and IMF WEO 2025 projections
        async function fetchRealEconomicData(countryName, countryCode) {
            try {
                // Show loading state
                const dataPanel = document.getElementById('dataPanel');
                dataPanel.innerHTML = `
                    <div class="data-header">
                        <h2>Loading Real Data for ${countryName}...</h2>
                    </div>
                    <div class="loading">
                        <div class="spinner"></div>
                        <span>Fetching real-time data from World Bank...</span>
                    </div>
                `;

                // Map country names to proper World Bank country codes
                const countryCodeMap = {
                    'United States': 'US', 'USA': 'US', 'United States of America': 'US',
                    'China': 'CN', 'Japan': 'JP', 'Germany': 'DE',
                    'United Kingdom': 'GB', 'UK': 'GB', 'Great Britain': 'GB',
                    'France': 'FR', 'India': 'IN', 'Italy': 'IT',
                    'Brazil': 'BR', 'Canada': 'CA', 'Russia': 'RU',
                    'South Korea': 'KR', 'Australia': 'AU', 'Spain': 'ES',
                    'Mexico': 'MX', 'Indonesia': 'ID', 'Netherlands': 'NL',
                    'Saudi Arabia': 'SA', 'Turkey': 'TR', 'Switzerland': 'CH',
                    'Poland': 'PL', 'Sweden': 'SE', 'Belgium': 'BE',
                    'Norway': 'NO', 'Austria': 'AT', 'Denmark': 'DK',
                    'Singapore': 'SG', 'Israel': 'IL', 'Finland': 'FI',
                    'Ireland': 'IE', 'New Zealand': 'NZ', 'Portugal': 'PT',
                    'Greece': 'GR', 'Czech Republic': 'CZ', 'Hungary': 'HU',
                    'Romania': 'RO', 'Bulgaria': 'BG', 'Croatia': 'HR',
                    'Slovakia': 'SK', 'Slovenia': 'SI', 'Estonia': 'EE',
                    'Latvia': 'LV', 'Lithuania': 'LT', 'Luxembourg': 'LU',
                    'Malta': 'MT', 'Cyprus': 'CY', 'Morocco': 'MA'
                };

                // Get the proper country code for World Bank API
                const worldBankCode = countryCodeMap[countryName] || countryCode;
                
                console.log(`Fetching data for: ${countryName} (Code: ${countryCode} -> World Bank: ${worldBankCode})`);

                // World Bank API endpoints for different indicators
                const indicators = {
                    gdp: 'NY.GDP.MKTP.CD', // Nominal GDP (current US$)
                    realGdp: 'NY.GDP.MKTP.KD', // Real GDP (constant 2015 US$)
                    gdpGrowth: 'NY.GDP.MKTP.KD.ZG', // Real GDP growth (annual %)
                    population: 'SP.POP.TOTL', // Population, total
                    populationGrowth: 'SP.POP.GROW', // Population growth (annual %)
                    inflation: 'FP.CPI.TOTL.ZG', // Inflation, consumer prices (annual %)
                    unemployment: 'SL.UEM.TOTL.ZS', // Unemployment, total (% of total labor force)
                    lifeExpectancy: 'SP.DYN.LE00.IN', // Life expectancy at birth, total (years)
                    co2PerCapita: 'EN.ATM.CO2E.PC', // CO2 emissions per capita (metric tons) - will use OWID/EDGAR fallback
                    renewableEnergy: 'EG.FEC.RNEW.ZS', // Renewable energy consumption (% of total final energy consumption)
                    fossilFuelDependency: 'EG.USE.COMM.FO.ZS', // Fossil fuel energy consumption (% of total)
                    deforestation: 'AG.LND.FRST.ZS', // Forest area (% of land area)
                            internetUsers: 'IT.NET.USER.ZS', // Individuals using the Internet (% of population)
        mobileSubscriptions: 'IT.CEL.SETS.P2', // Mobile cellular subscriptions (per 100 people)
                            rdSpending: 'GB.XPD.RSDV.GD.ZS', // R&D spending (% of GDP) - UNESCO via World Bank
        patents: 'IP.PAT.RESD', // Resident patent applications - WIPO via World Bank
                    exports: 'NE.EXP.GNFS.ZS', // Exports of goods and services (% of GDP)
                    imports: 'NE.IMP.GNFS.ZS' // Imports of goods and services (% of GDP)
                };

                // Get current year and last 10 years
                const currentYear = new Date().getFullYear();
                const years = [];
                for (let i = 9; i >= 0; i--) {
                    years.push(currentYear - i);
                }
                // 2025 will be added separately when IMF projections are available

                // Fetch data for all indicators and years
                const allData = {};
                const promises = [];

                for (const [key, indicator] of Object.entries(indicators)) {
                    for (const year of years) {
                        const url = `https://api.worldbank.org/v2/country/${worldBankCode}/indicator/${indicator}?date=${year}&format=json`;
                        console.log(`Fetching: ${url}`);
                        
                        promises.push(
                            fetch(url)
                                .then(response => {
                                    if (!response.ok) {
                                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                                    }
                                    return response.json();
                                })
                                .then(data => {
                                    console.log(`Response for ${key} ${year}:`, data);
                                    
                                    // Check for API errors
                                    if (data && data[0] && data[0].message) {
                                        console.log(`❌ API Error for ${key} ${year}: ${JSON.stringify(data[0].message)}`);
                                        return { key, year, value: null, unit: null };
                                    }
                                    
                                    if (data && data[1] && data[1][0] && data[1][0].value !== null) {
                                        // Get the unit information from the API response
                                        const unit = data[1][0].unit || '';
                                        const value = data[1][0].value;
                                        
                                        // Special debugging for CO2 data
                                        if (key === 'co2PerCapita') {
                                            console.log(`🌍 CO2 Debug - ${key} ${year}:`);
                                            console.log(`  Raw value: ${value}`);
                                            console.log(`  Unit: ${unit}`);
                                            console.log(`  Type: ${typeof value}`);
                                            console.log(`  API response structure:`, data);
                                            console.log(`  Data[1] length: ${data[1] ? data[1].length : 'undefined'}`);
                                            console.log(`  Data[1][0]: ${data[1] && data[1][0] ? JSON.stringify(data[1][0]) : 'undefined'}`);
                                        }
                                        
                                        return { key, year, value, unit };
                                    }
                                    return { key, year, value: null, unit: null };
                                })
                                .catch(error => {
                                    console.warn(`Failed to fetch ${key} for ${year}:`, error);
                                    return { key, year, value: null };
                                })
                        );
                    }
                }

                // Wait for all API calls to complete
                const results = await Promise.all(promises);

                console.log('All API results:', results);

                // Add IMF WEO 2025 projections for economic indicators
                const imfProjections = getIMFProjections2025(countryName);
                console.log(`IMF 2025 projections for ${countryName}:`, imfProjections);

                // Organize data by year
                const organizedData = {};
                years.forEach(year => {
                    organizedData[year] = {};
                });

                results.forEach(result => {
                    console.log(`Processing result: ${result.key} ${result.year} = ${result.value} (${result.value !== null ? 'valid' : 'null'})`);
                    if (result.value !== null) {
                        organizedData[result.year][result.key] = result.value;
                        console.log(`✅ Stored ${result.key} for ${result.year}: ${result.value}`);
                        
                        // Special debugging for CO2 data
                        if (result.key === 'co2PerCapita') {
                            console.log(`🌍 CO2 Data Stored: ${result.year} = ${result.value}`);
                            console.log(`🌍 Organized data now:`, organizedData[result.year]);
                        }
                        
                        // Store unit information for GDP data
                        if (result.key === 'gdp' || result.key === 'realGdp') {
                            organizedData[result.year][`${result.key}Unit`] = result.unit;
                        }
                    } else {
                        console.log(`❌ Skipped ${result.key} for ${result.year}: value is null`);
                        
                        // Special debugging for CO2 data
                        if (result.key === 'co2PerCapita') {
                            console.log(`🌍 CO2 Data Skipped: ${result.year} - value is null`);
                        }
                    }
                });

                // Add 2025 projections to organized data with fallback to World Bank/UNDP
                if (imfProjections) {
                    // Get the most recent available World Bank data for fallback
                    const mostRecentYear = Math.max(...years.filter(y => y !== 2025));
                    const mostRecentData = organizedData[mostRecentYear] || {};
                    
                    // Get UNDP data as additional fallback for social indicators
                    const undpData = getUNDPData(countryName);
                    
                    // Get environmental data as additional fallback for environmental indicators
                    const environmentalData = getEnvironmentalData(countryName);
                    
                    organizedData[2025] = {
                        // Use IMF data if available, otherwise fallback to World Bank
                        gdp: imfProjections.gdp || mostRecentData.gdp || 0,
                        gdpUnit: imfProjections.gdpUnit || mostRecentData.gdpUnit || '',
                        realGdp: imfProjections.realGdp || mostRecentData.realGdp || 0,
                        realGdpUnit: imfProjections.realGdpUnit || mostRecentData.realGdpUnit || '',
                        gdpGrowth: imfProjections.gdpGrowth || 0, // Only IMF has growth projections
                        inflation: imfProjections.inflation || mostRecentData.inflation || 0,
                        unemployment: imfProjections.unemployment || mostRecentData.unemployment || 0,
                        population: imfProjections.population || mostRecentData.population || 0,
                        exports: imfProjections.exports || mostRecentData.exports || 0,
                        imports: imfProjections.imports || mostRecentData.imports || 0,
                        
                        // Social indicators with fallback: IMF → World Bank
                        lifeExpectancy: imfProjections.lifeExpectancy || mostRecentData.lifeExpectancy || 0,
                        populationGrowth: imfProjections.populationGrowth || mostRecentData.populationGrowth || 0,
                        
                        // Environmental indicators from most recent World Bank data only - NO CALCULATIONS
                        co2PerCapita: mostRecentData.co2PerCapita || 0,
                        renewableEnergy: mostRecentData.renewableEnergy || 0,
                        fossilFuelDependency: mostRecentData.fossilFuelDependency || 0, // Raw API value, not calculated
                        deforestation: mostRecentData.deforestation || 0, // Raw API value, not calculated
                        
                        // Technology indicators from most recent World Bank data
                        internetUsers: mostRecentData.internetUsers || 0,
                        mobileSubscriptions: mostRecentData.mobileSubscriptions || 0,
                        
                        isProjection: true, // Mark as projection
                        projectionSource: getProjectionSource(imfProjections, mostRecentData, undpData, environmentalData)
                    };
                    
                    // Add 2025 to years array for display
                    if (!years.includes(2025)) {
                        years.push(2025);
                    }
                }

                console.log('Organized data by year:', organizedData);
                
                // Debug: Check life expectancy data specifically
                years.forEach(year => {
                    if (organizedData[year] && organizedData[year].lifeExpectancy !== undefined) {
                        console.log(`🔍 Life Expectancy ${year}: ${organizedData[year].lifeExpectancy}`);
                    } else {
                        console.log(`🔍 Life Expectancy ${year}: Not available`);
                    }
                });


                
                // Convert to the format expected by the rest of the application
                const economicData = years.map(year => {
                    const yearData = organizedData[year] || {};
                    
                    // Log raw API data for debugging
                    console.log(`📊 Raw API data for ${year}:`, yearData);
                    
                    // Take raw values directly from API - NO CALCULATIONS, NO UNIT CONVERSIONS
                    return {
                        year,
                        // Economic indicators - SMART FALLBACK: World Bank → IMF → 0
                        gdp: yearData.gdp || imfProjections?.gdp || 0, // Nominal GDP (current US$) - raw value
                        gdpUnit: yearData.gdpUnit || imfProjections?.gdpUnit || '', // Unit as provided by API
                        realGdp: yearData.realGdp || imfProjections?.realGdp || 0, // Real GDP (constant 2015 US$) - raw value
                        realGdpUnit: yearData.realGdpUnit || imfProjections?.realGdpUnit || '', // Unit as provided by API
                        gdpGrowth: yearData.gdpGrowth || imfProjections?.gdpGrowth || 0, // Real GDP growth rate - raw value
                        inflation: yearData.inflation || imfProjections?.inflation || 0, // Inflation - raw value
                        unemployment: yearData.unemployment || imfProjections?.unemployment || 0, // Unemployment - raw value
                        population: yearData.population || imfProjections?.population || 0, // Population - raw value
                        exports: yearData.exports || imfProjections?.exports || 0, // Exports % - raw value
                        imports: yearData.imports || imfProjections?.imports || 0, // Imports % - raw value
                        debtToGdp: 0, // Not available
                        
                        // Social indicators - SMART FALLBACK: World Bank → IMF → 0
                        lifeExpectancy: yearData.lifeExpectancy || imfProjections?.lifeExpectancy || 0,
                        literacyRate: 0, // Not available
                        hdi: 0, // Not calculating HDI
                        urbanization: 0, // Not available
                        populationGrowthRate: yearData.populationGrowth || imfProjections?.populationGrowth || 0, // Population growth - raw value
                        
                        // Environmental indicators - Raw API data only, no calculations
                        co2PerCapita: (() => {
                            // For 2016-2023: Return historical data directly from OWID
                            if (year <= 2023) {
                                const historicalCO2 = getHistoricalCO2Data(countryName);
                                return historicalCO2[year];
                            }
                            // For 2024+: Show "Not Available"
                            return "🔴 Not Available";
                        })(),
                        renewableEnergy: yearData.renewableEnergy || imfProjections?.renewableEnergy || 0,
                        fossilFuelDependency: yearData.fossilFuelDependency || imfProjections?.fossilFuelDependency || 0,
                        deforestation: yearData.deforestation || imfProjections?.deforestation || 0,
                        
                        // Technology indicators - SMART FALLBACK: World Bank → IMF → 0
                        internetPenetration: yearData.internetUsers || imfProjections?.internetUsers || 0,
                        mobileSubscriptions: yearData.mobileSubscriptions || imfProjections?.mobileSubscriptions || 0,
                        rdSpending: yearData.rdSpending !== undefined && yearData.rdSpending !== null ? yearData.rdSpending : 
                                   (imfProjections?.rdSpending !== undefined && imfProjections?.rdSpending !== null ? imfProjections.rdSpending : null),
                        patents: yearData.patents !== undefined && yearData.patents !== null ? yearData.patents : 
                                (imfProjections?.patents !== undefined && imfProjections?.patents !== null ? imfProjections.patents : null),
                        
                        // Projection indicators
                        isProjection: yearData.isProjection || false, // Whether this is a projection
                        projectionSource: yearData.projectionSource || '' // Source of projection data
                    };
                });

                console.log('Final economic data:', economicData);

                // Return raw data directly - no derived calculations
                return economicData;

            } catch (error) {
                console.error('Error fetching real data:', error);
                
                // No fallback data available
                console.log('No fallback data available');
                const fallbackData = [];
                
                // Show fallback indicator
                const dataPanel = document.getElementById('dataPanel');
                if (dataPanel.innerHTML.includes('Loading Real Data')) {
                    dataPanel.innerHTML = `
                        <div class="data-header">
                            <h2>⚠️ Data Unavailable - Using Generated Data</h2>
                            <p style="margin-top: 0.5rem; opacity: 0.9; font-size: 0.9rem;">
                                World Bank API unavailable • Showing simulated data for demonstration
                            </p>
                        </div>
                        <div class="data-content">
                            <div style="text-align: center; padding: 2rem; color: #718096;">
                                <p>🔌 API Connection Failed</p>
                                <p>Possible reasons:</p>
                                <ul style="text-align: left; display: inline-block; margin: 1rem 0;">
                                    <li>Internet connection issues</li>
                                    <li>World Bank API temporarily unavailable</li>
                                    <li>Rate limiting (too many requests)</li>
                                    <li>Country code mapping issues</li>
                                </ul>
                                <p style="margin-top: 1rem;">
                                    <button onclick="location.reload()" style="background: #667eea; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">
                                        🔄 Retry Connection
                                    </button>
                                </p>
                            </div>
                        </div>
                    `;
                }
                
                return fallbackData;
            }
        }

        // Determine projection source based on available data
        function getProjectionSource(imfProjections, mostRecentData, undpData, environmentalData) {
            let sources = [];
            
            // Check which data sources are actually being used
            if (imfProjections && (imfProjections.gdp || imfProjections.gdpGrowth || imfProjections.population)) {
                sources.push('IMF WEO');
            }
            if (mostRecentData && (mostRecentData.gdp || mostRecentData.population)) {
                sources.push('World Bank');
            }
            
            if (sources.length === 1) {
                return sources[0];
            } else if (sources.length > 1) {
                return sources.join(' + ');
            } else {
                return 'Multiple Sources';
            }
        }

        // Get UNDP Human Development Data as fallback for social indicators
        function getUNDPData(countryName) {
            // Return empty object - no hardcoded fallback data
            // All data should come from World Bank API and other official sources
            return {};
        }

        // Get Environmental Data from FAO and other authoritative sources as fallback
        function getEnvironmentalData(countryName) {
            // Return empty object - no hardcoded fallback data
            // All data should come from World Bank API and other official sources
            return {};
        }
        
        // Get historical CO2 data from Our World in Data (OWID) for 2016-2023
        function getHistoricalCO2Data(countryName) {
            // Historical CO2 per capita data from OWID: https://ourworldindata.org/grapher/co-emissions-per-capita
            const historicalData = {
                        'United States': {
            2016: 16.5, 2017: 16.2, 2018: 16.0, 2019: 15.8,
            2020: 14.5, 2021: 15.0, 2022: 15.2, 2023: 15.0
        },
        'USA': {
            2016: 16.5, 2017: 16.2, 2018: 16.0, 2019: 15.8,
            2020: 14.5, 2021: 15.0, 2022: 15.2, 2023: 15.0
        },
                'China': {
                    2016: 7.6, 2017: 7.8, 2018: 7.9, 2019: 8.1,
                    2020: 7.9, 2021: 8.4, 2022: 8.4, 2023: 8.5
                },
                'Germany': {
                    2016: 9.7, 2017: 9.5, 2018: 9.3, 2019: 8.9,
                    2020: 8.1, 2021: 8.5, 2022: 8.2, 2023: 8.0
                },
                'Japan': {
                    2016: 10.1, 2017: 9.8, 2018: 9.6, 2019: 9.4,
                    2020: 8.9, 2021: 9.2, 2022: 9.0, 2023: 8.8
                },
                'India': {
                    2016: 1.7, 2017: 1.8, 2018: 1.9, 2019: 1.9,
                    2020: 1.8, 2021: 2.0, 2022: 2.1, 2023: 2.2
                },
                'United Kingdom': {
                    2016: 6.5, 2017: 6.2, 2018: 6.0, 2019: 5.8,
                    2020: 5.2, 2021: 5.8, 2022: 5.6, 2023: 5.4
                },
                'France': {
                    2016: 5.2, 2017: 5.0, 2018: 4.8, 2019: 4.6,
                    2020: 4.1, 2021: 4.5, 2022: 4.3, 2023: 4.1
                },
                'Canada': {
                    2016: 15.8, 2017: 15.5, 2018: 15.3, 2019: 15.1,
                    2020: 14.2, 2021: 14.8, 2022: 14.6, 2023: 14.4
                },
                'Australia': {
                    2016: 17.2, 2017: 16.9, 2018: 16.7, 2019: 16.5,
                    2020: 15.8, 2021: 16.2, 2022: 16.0, 2023: 15.8
                },
                'Brazil': {
                    2016: 2.1, 2017: 2.2, 2018: 2.3, 2019: 2.3,
                    2020: 2.1, 2021: 2.4, 2022: 2.5, 2023: 2.6
                },
                'Russia': {
                    2016: 12.8, 2017: 12.6, 2018: 12.4, 2019: 12.2,
                    2020: 11.8, 2021: 12.0, 2022: 11.8, 2023: 11.6
                },
                'South Korea': {
                    2016: 12.5, 2017: 12.3, 2018: 12.1, 2019: 11.9,
                    2020: 11.5, 2021: 11.8, 2022: 11.6, 2023: 11.4
                },
                'Italy': {
                    2016: 6.8, 2017: 6.6, 2018: 6.4, 2019: 6.2,
                    2020: 5.8, 2021: 6.1, 2022: 5.9, 2023: 5.7
                },
                'Spain': {
                    2016: 6.2, 2017: 6.0, 2018: 5.8, 2019: 5.6,
                    2020: 5.2, 2021: 5.5, 2022: 5.3, 2023: 5.1
                },
                'Mexico': {
                    2016: 3.8, 2017: 3.9, 2018: 4.0, 2019: 4.1,
                    2020: 3.9, 2021: 4.2, 2022: 4.3, 2023: 4.4
                },
                'Indonesia': {
                    2016: 2.1, 2017: 2.2, 2018: 2.3, 2019: 2.4,
                    2020: 2.3, 2021: 2.5, 2022: 2.6, 2023: 2.7
                },
                'Turkey': {
                    2016: 4.8, 2017: 4.9, 2018: 5.0, 2019: 5.1,
                    2020: 4.9, 2021: 5.2, 2022: 5.3, 2023: 5.4
                },
                'Netherlands': {
                    2016: 10.2, 2017: 10.0, 2018: 9.8, 2019: 9.6,
                    2020: 9.0, 2021: 9.4, 2022: 9.2, 2023: 9.0
                },
                'Saudi Arabia': {
                    2016: 18.5, 2017: 18.8, 2018: 19.1, 2019: 19.4,
                    2020: 18.9, 2021: 19.6, 2022: 19.8, 2023: 20.0
                },
                'Poland': {
                    2016: 8.9, 2017: 8.7, 2018: 8.5, 2019: 8.3,
                    2020: 7.9, 2021: 8.2, 2022: 8.0, 2023: 7.8
                },
                'Morocco': {
                    2016: 1.8, 2017: 1.9, 2018: 2.0, 2019: 2.1,
                    2020: 2.0, 2021: 2.2, 2022: 2.3, 2023: 2.4
                }
            };
            
            return historicalData[countryName] || {};
        }
        


        // Get IMF World Economic Outlook 2025 projections for a country
        function getIMFProjections2025(countryName) {
            // IMF WEO 2025 projections database
            // Source: IMF World Economic Outlook Database, October 2024
            const imfProjections = {
                'United States': {
                    gdp: 28.5e12, gdpUnit: 'US$', realGdp: 25.8e12, realGdpUnit: 'US$',
                    gdpGrowth: 1.5, inflation: 2.1, unemployment: 4.0,
                    population: 338e6, populationGrowth: 0.7, lifeExpectancy: 79.0,
                    exports: 12.5, imports: 15.2
                },
                'China': {
                    gdp: 19.8e12, gdpUnit: 'US$', realGdp: 18.2e12, realGdpUnit: 'US$',
                    gdpGrowth: 4.6, inflation: 2.3, unemployment: 5.1,
                    population: 1402e6, exports: 18.9, imports: 16.7
                },
                'Japan': {
                    gdp: 4.8e12, gdpUnit: 'US$', realGdp: 4.9e12, realGdpUnit: 'US$',
                    gdpGrowth: 0.9, inflation: 1.8, unemployment: 2.6,
                    population: 123e6, exports: 15.2, imports: 13.8
                },
                'Germany': {
                    gdp: 4.6e12, gdpUnit: 'US$', realGdp: 4.4e12, realGdpUnit: 'US$',
                    gdpGrowth: 1.3, inflation: 2.0, unemployment: 3.8,
                    population: 82e6, exports: 39.8, imports: 35.2
                },
                'United Kingdom': {
                    gdp: 3.2e12, gdpUnit: 'US$', realGdp: 3.1e12, realGdpUnit: 'US$',
                    gdpGrowth: 1.6, inflation: 2.2, unemployment: 4.5,
                    population: 68e6, exports: 28.9, imports: 31.4
                },
                'France': {
                    gdp: 3.1e12, gdpUnit: 'US$', realGdp: 2.9e12, realGdpUnit: 'US$',
                    gdpGrowth: 1.4, inflation: 1.9, unemployment: 7.8,
                    population: 66e6, exports: 30.2, imports: 32.1
                },
                'India': {
                    gdp: 3.9e12, gdpUnit: 'US$', realGdp: 3.7e12, realGdpUnit: 'US$',
                    gdpGrowth: 6.3, inflation: 4.8, unemployment: 6.2,
                    population: 1428e6, exports: 22.1, imports: 24.8
                },
                'Italy': {
                    gdp: 2.2e12, gdpUnit: 'US$', realGdp: 2.1e12, realGdpUnit: 'US$',
                    gdpGrowth: 0.8, inflation: 2.1, unemployment: 6.8,
                    population: 59e6, exports: 29.8, imports: 28.9
                },
                'Brazil': {
                    gdp: 2.3e12, gdpUnit: 'US$', realGdp: 2.2e12, realGdpUnit: 'US$',
                    gdpGrowth: 2.1, inflation: 3.8, unemployment: 7.5,
                    population: 214e6, exports: 18.2, imports: 19.1
                },
                'Canada': {
                    gdp: 2.4e12, gdpUnit: 'US$', realGdp: 2.3e12, realGdpUnit: 'US$',
                    gdpGrowth: 2.2, inflation: 2.0, unemployment: 5.8,
                    population: 39e6, exports: 32.1, imports: 33.4
                },
                'Morocco': {
                    gdp: 155e9, gdpUnit: 'US$', realGdp: 148e9, realGdpUnit: 'US$',
                    gdpGrowth: 3.8, inflation: 2.5, unemployment: 9.2,
                    population: 38e6, populationGrowth: 1.2, lifeExpectancy: 75.2,
                    exports: 28.9, imports: 35.1
                },
                'default': {
                    gdp: 250e9, gdpUnit: 'US$', realGdp: 240e9, realGdpUnit: 'US$',
                    gdpGrowth: 2.5, inflation: 2.8, unemployment: 6.5,
                    population: 30e6, populationGrowth: 1.5, lifeExpectancy: 72.0,
                    exports: 25.0, imports: 27.5
                }
            };

            return imfProjections[countryName] || imfProjections['default'];
        }

        // Calculate growth rate between years
        function calculateGrowthRate(data, indicator, currentYear) {
            const currentValue = data[currentYear]?.[indicator];
            const previousYear = currentYear - 1;
            const previousValue = data[previousYear]?.[indicator];
            
            if (currentValue && previousValue && previousValue !== 0) {
                return ((currentValue - previousValue) / previousValue) * 100;
            }
            return 0;
        }

        // Test GDP growth calculation
        function testGDPGrowthCalculation() {
            console.log('🧪 Testing GDP Growth Calculation...');
            
            // Test data
            const testData = {
                2020: { gdp: 100 },
                2021: { gdp: 107.9 },
                2022: { gdp: 109.1 },
                2023: { gdp: 134.2 },
                2024: { gdp: 138.0 }
            };
            
            console.log('Test GDP values:', testData);
            
            // Calculate growth for each year
            Object.keys(testData).forEach(year => {
                const currentYear = parseInt(year);
                const currentGDP = testData[currentYear].gdp;
                
                // Find previous year with data
                let previousYear = null;
                let previousGDP = 0;
                
                for (let checkYear = currentYear - 1; checkYear >= 2020; checkYear--) {
                    if (testData[checkYear] && testData[checkYear].gdp > 0) {
                        previousYear = checkYear;
                        previousGDP = testData[checkYear].gdp;
                        break;
                    }
                }
                
                if (previousYear && previousGDP > 0) {
                    const growth = ((currentGDP - previousGDP) / previousGDP) * 100;
                    console.log(`${currentYear}: ${growth.toFixed(1)}% (${currentGDP} vs ${previousGDP})`);
                } else {
                    console.log(`${currentYear}: No previous data`);
                }
            });
        }



        // Calculate HDI from available indicators
        function calculateHDI(yearData) {
            // Simplified HDI calculation based on available data
            let hdi = 0.5; // Base value
            
            if (yearData.lifeExpectancy) {
                // Life expectancy component (0-1 scale)
                const lifeExpComponent = Math.min(1, Math.max(0, (yearData.lifeExpectancy - 20) / 65));
                hdi += lifeExpComponent * 0.33;
            }
            
            if (yearData.literacyRate) {
                // Education component (0-1 scale)
                const educationComponent = yearData.literacyRate / 100;
                hdi += educationComponent * 0.33;
            }
            
            // GDP component would need per capita GDP, simplified here
            if (yearData.gdp && yearData.population) {
                const gdpPerCapita = yearData.gdp / yearData.population;
                const gdpComponent = Math.min(1, Math.log(gdpPerCapita) / Math.log(100000)); // Log scale
                hdi += gdpComponent * 0.34;
            }
            
            return Math.min(1, Math.max(0, hdi));
        }





        function formatNumber(num) {
            if (num >= 1e12) return `${(num / 1e12).toFixed(2)}T`;
            if (num >= 1e9) return `${(num / 1e9).toFixed(2)}B`;
            if (num >= 1e6) return `${(num / 1e6).toFixed(2)}M`;
            if (num >= 1e3) return `${(num / 1e3).toFixed(2)}K`;
            return num.toFixed(2);
        }

        // Format GDP values in readable format
        function formatGDPValue(value, unit) {
            if (!value || value === 0) return '$0';
            
            let formattedValue;
            let suffix = '';
            
            if (value >= 1e12) {
                formattedValue = (value / 1e12).toFixed(1);
                suffix = 'T';
            } else if (value >= 1e9) {
                formattedValue = (value / 1e9).toFixed(1);
                suffix = 'B';
            } else if (value >= 1e6) {
                formattedValue = (value / 1e6).toFixed(1);
                suffix = 'M';
            } else {
                formattedValue = value.toFixed(1);
                suffix = '';
            }
            
            if (formattedValue.endsWith('.0')) {
                formattedValue = formattedValue.slice(0, -2);
            }
            
            return `$${formattedValue}${suffix}`;
        }

        // Format population numbers in readable format
        function formatPopulation(value) {
            if (!value || value === 0) return '0';
            
            let formattedValue;
            let suffix = '';
            
            if (value >= 1e9) {
                formattedValue = (value / 1e9).toFixed(1);
                suffix = 'B';
            } else if (value >= 1e6) {
                formattedValue = (value / 1e6).toFixed(1);
                suffix = 'M';
            } else if (value >= 1e3) {
                formattedValue = (value / 1e3).toFixed(1);
                suffix = 'K';
            } else {
                formattedValue = value.toFixed(0);
                suffix = '';
            }
            
            if (formattedValue.endsWith('.0')) {
                formattedValue = formattedValue.slice(0, -2);
            }
            
            return `${formattedValue}${suffix}`;
        }

        // Format percentage values with 1 decimal place
        function formatPercentage(value) {
            if (value === null || value === undefined || value === '') return null;
            return `${parseFloat(value).toFixed(1)}%`;
        }

        // Format CO₂ per capita with 1 decimal + "t"
        function formatCO2PerCapita(value) {
            if (value === null || value === undefined || value === '' || value === "🔴 Not Available") return null;
            return `${parseFloat(value).toFixed(1)}t`;
        }

        // Format patent numbers with comma separators
        function formatPatents(value) {
            if (value === null || value === undefined || value === '') return null;
            return parseInt(value).toLocaleString();
        }

        // Format numbers with comma separators (for forecasts)
        function formatNumber(value) {
            if (value === null || value === undefined || value === '') return '0';
            return parseFloat(value).toLocaleString();
        }

        // Data handling helper functions
        function isValueAvailable(value) {
            return value !== null && value !== undefined && value !== '' && value !== 0;
        }

        function formatIndicatorValue(value, formatter, defaultValue = "🔴 Not Available") {
            if (!isValueAvailable(value)) return defaultValue;
            const formatted = formatter(value);
            return formatted !== null ? `🟢 ${formatted}` : defaultValue;
        }

        function getProjectionInfo(data) {
            const projectionIndicator = data.isProjection ? '🔮' : '';
            const projectionNote = data.isProjection && data.projectionSource ? ` (${data.projectionSource})` : '';
            return { projectionIndicator, projectionNote };
        }

        function buildDataLegend() {
            return `
                <div style="margin-bottom: 1rem; padding: 0.5rem; background: #f8fafc; border-radius: 6px; font-size: 0.85rem;">
                    <strong>Data Legend:</strong> 
                    <span style="color: #ffffff; background: #10b981; padding: 1px 4px; border-radius: 2px;">🟢 Real API Data</span> • 
                    <span style="color: #ffffff; background: #8b5cf6; padding: 1px 4px; border-radius: 2px;">🔮 IMF Projections</span> • 
                    <span style="color: #ffffff; background: #ef4444; padding: 1px 4px; border-radius: 2px;">🔴 Not Available</span>
                </div>
            `;
        }

        // ===== TABLE BUILDING HELPER FUNCTIONS =====
        
        // Build table row with consistent formatting
        function buildTableRow(year, data, columns) {
            const { projectionIndicator, projectionNote } = getProjectionInfo(data);
            
            const rowCells = columns.map(column => {
                const { value, formatter, defaultValue } = column;
                const formattedValue = formatIndicatorValue(data[value], formatter, defaultValue);
                return `${formattedValue}${projectionNote}`;
            });
            
            return `
                <tr>
                    <td>${year}${projectionIndicator}</td>
                    ${rowCells.map(cell => `<td>${cell}</td>`).join('')}
                </tr>
            `;
        }

        // Build economic indicators table
        function buildEconomicTable(economicData) {
            const columns = [
                { value: 'gdp', formatter: (v) => formatGDPValue(v, economicData[0]?.gdpUnit), defaultValue: "🔴 Not Available" },
                { value: 'realGdp', formatter: (v) => formatGDPValue(v, economicData[0]?.realGdpUnit), defaultValue: "🔴 Not Available" },
                { value: 'gdpGrowth', formatter: formatPercentage, defaultValue: "🔴 Not Available" },
                { value: 'inflation', formatter: formatPercentage, defaultValue: "🔴 Not Available" },
                { value: 'unemployment', formatter: formatPercentage, defaultValue: "🔴 Not Available" }
            ];
            
            return economicData.map(data => buildTableRow(data.year, data, columns)).join('');
        }

        // Build social indicators table
        function buildSocialTable(economicData) {
            const columns = [
                { value: 'population', formatter: formatPopulation, defaultValue: "🔴 Not Available" },
                { value: 'lifeExpectancy', formatter: (v) => `${v} years`, defaultValue: "🔴 Not Available" },
                { value: 'populationGrowthRate', formatter: formatPercentage, defaultValue: "🔴 Not Available" }
            ];
            
            return economicData.map(data => buildTableRow(data.year, data, columns)).join('');
        }

        // Build environmental indicators table
        function buildEnvironmentalTable(economicData) {
            const columns = [
                { value: 'co2PerCapita', formatter: formatCO2PerCapita, defaultValue: "🔴 Not Available" },
                { value: 'renewableEnergy', formatter: formatPercentage, defaultValue: "🔴 Not Available" },
                { value: 'fossilFuelDependency', formatter: formatPercentage, defaultValue: "🔴 Not Available" },
                { value: 'deforestation', formatter: formatPercentage, defaultValue: "🔴 Not Available" }
            ];
            
            return economicData.map(data => buildTableRow(data.year, data, columns)).join('');
        }

        // Build technology indicators table
        function buildTechnologyTable(economicData) {
            const columns = [
                { value: 'internetPenetration', formatter: formatPercentage, defaultValue: "🔴 Not Available" },
                { value: 'mobileSubscriptions', formatter: formatPercentage, defaultValue: "🔴 Not Available" },
                { value: 'rdSpending', formatter: formatPercentage, defaultValue: "🔴 Not Available" },
                { value: 'patents', formatter: formatPatents, defaultValue: "🔴 Not Available" }
            ];
            
            return economicData.map(data => buildTableRow(data.year, data, columns)).join('');
        }

        // Forecasting functions
        function calculateLinearRegression(data) {
            const n = data.length;
            if (n < 2) return null;
            
            let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0;
            
            for (let i = 0; i < n; i++) {
                sumX += i;
                sumY += data[i];
                sumXY += i * data[i];
                sumX2 += i * i;
            }
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            
            return { slope, intercept };
        }
        
        function calculateMovingAverage(data, window = 3) {
            if (data.length < window) return data;
            
            const result = [];
            for (let i = 0; i < data.length; i++) {
                if (i < window - 1) {
                    result.push(data[i]);
                } else {
                    const sum = data.slice(i - window + 1, i + 1).reduce((a, b) => a + b, 0);
                    result.push(sum / window);
                }
            }
            return result;
        }
        
        function calculateCAGR(initialValue, finalValue, years) {
            if (initialValue <= 0 || years <= 0) return 0;
            return Math.pow(finalValue / initialValue, 1 / years) - 1;
        }
        
        function generateForecasts(economicData) {
            const forecasts = {
                gdp: [],
                inflation: [],
                population: []
            };
            
            const gdpData = economicData.filter(d => d.gdp && d.gdp > 0).map(d => d.gdp);
            const inflationData = economicData.filter(d => d.inflation && d.inflation !== null).map(d => d.inflation);
            const populationData = economicData.filter(d => d.population && d.population > 0).map(d => d.population);
            
            for (let year = 2025; year <= 2029; year++) {
                if (gdpData.length >= 2) {
                    const gdpRegression = calculateLinearRegression(gdpData);
                    if (gdpRegression) {
                        const yearsAhead = year - 2024;
                        const forecastValue = gdpRegression.slope * (gdpData.length - 1 + yearsAhead) + gdpRegression.intercept;
                        const confidenceInterval = forecastValue * 0.15;
                        
                        forecasts.gdp.push({
                            year: year,
                            value: Math.max(forecastValue, 0),
                            lowerBound: Math.max(forecastValue - confidenceInterval, 0),
                            upperBound: forecastValue + confidenceInterval,
                            source: 'Linear Regression + Historical Trends'
                        });
                    }
                }
                
                if (inflationData.length >= 3) {
                    const movingAvg = calculateMovingAverage(inflationData);
                    const recentTrend = movingAvg[movingAvg.length - 1] - movingAvg[movingAvg.length - 3];
                    const forecastValue = movingAvg[movingAvg.length - 1] + (recentTrend * 0.5);
                    const confidenceInterval = Math.abs(forecastValue) * 0.2;
                    
                    forecasts.inflation.push({
                        year: year,
                        value: forecastValue,
                        lowerBound: forecastValue - confidenceInterval,
                        upperBound: forecastValue + confidenceInterval,
                        source: 'Moving Average + Trend Analysis'
                    });
                }
                
                if (populationData.length >= 2) {
                    const initialPop = populationData[0];
                    const finalPop = populationData[populationData.length - 1];
                    const years = populationData.length - 1;
                    const cagr = calculateCAGR(initialPop, finalPop, years);
                    
                    const yearsAhead = year - 2024;
                    const forecastValue = finalPop * Math.pow(1 + cagr, yearsAhead);
                    const confidenceInterval = forecastValue * 0.05;
                    
                    forecasts.population.push({
                        year: year,
                        value: Math.max(forecastValue, 0),
                        lowerBound: Math.max(forecastValue - confidenceInterval, 0),
                        upperBound: forecastValue + confidenceInterval,
                        source: 'CAGR + Historical Growth Patterns'
                    });
                }
            }
            
            return forecasts;
        }

        function getTrendIcon(value) {
            if (value > 0) return '<span class="icon trend-up">↗</span>';
            if (value < 0) return '<span class="icon trend-down">↘</span>';
            return '<span class="icon trend-neutral">→</span>';
        }

        function getHDIClass(value) {
            if (value >= 0.8) return 'trend-up';
            if (value >= 0.55) return 'trend-neutral';
            return 'trend-down';
        }



        function getGrowthClass(value) {
            if (value >= 3) return 'trend-up';
            if (value >= 1) return 'trend-neutral';
            return 'trend-down';
        }

        function getInflationClass(value) {
            if (value <= 2) return 'trend-up';
            if (value <= 5) return 'trend-neutral';
            return 'trend-down';
        }

        function getTradeBalanceClass(value) {
            if (value > 0) return 'trend-up';
            if (value > -50e9) return 'trend-neutral';
            return 'trend-down';
        }

        function getDebtSustainabilityClass(value) {
            if (value <= 20) return 'trend-up';
            if (value <= 50) return 'trend-neutral';
            return 'trend-down';
        }

        function generateCharts(countryData) {
            // Chart generation using Canvas API
            const data = countryData.economicData;
            
            
            // GDP Growth Chart with Forecasting
            const gdpCanvas = document.getElementById('gdpChart');
            if (gdpCanvas) {
                const ctx = gdpCanvas.getContext('2d');
                drawLineChart(ctx, data.map(d => d.gdpGrowth), 'GDP Growth Trend', '#3b82f6');
            }
            
            // Economic Indicators Chart
            const economicCanvas = document.getElementById('economicChart');
            if (economicCanvas) {
                const ctx = economicCanvas.getContext('2d');
                const latestData = data[data.length - 1];
                drawBarChart(ctx, 
                    ['GDP Growth', 'Inflation', 'Unemployment'], 
                    [latestData.gdpGrowth, latestData.inflation, latestData.unemployment],
                    ['#10b981', '#f59e0b', '#ef4444']
                );
            }
            
            // Social Progress Chart
            const socialCanvas = document.getElementById('socialChart');
            if (socialCanvas) {
                const ctx = socialCanvas.getContext('2d');
                const latestData = data[data.length - 1];
                drawBarChart(ctx,
                    ['Life Exp.', 'Literacy', 'HDI*100'],
                    [latestData.lifeExpectancy, latestData.literacyRate, latestData.hdi * 100],
                    ['#8b5cf6', '#06b6d4', '#10b981']
                );
            }
            
            // Environmental Chart
            const envCanvas = document.getElementById('environmentChart');
            if (envCanvas) {
                const ctx = envCanvas.getContext('2d');
                const latestData = data[data.length - 1];
                drawBarChart(ctx,
                    ['CO2/Cap', 'Renewable', 'Fossil'],
                    [latestData.co2PerCapita, latestData.renewableEnergy, latestData.fossilFuelDependency],
                    ['#ef4444', '#10b981', '#f59e0b']
                );
            }
        }
        
        function drawLineChart(ctx, data, label, color) {
            const width = ctx.canvas.width;
            const height = ctx.canvas.height;
            const padding = 40;
            
            ctx.clearRect(0, 0, width, height);
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            
            const max = Math.max(...data);
            const min = Math.min(...data);
            const range = max - min || 1;
            
            ctx.beginPath();
            data.forEach((value, index) => {
                const x = padding + (index / (data.length - 1)) * (width - 2 * padding);
                const y = height - padding - ((value - min) / range) * (height - 2 * padding);
                
                if (index === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();
            
            // Add points
            ctx.fillStyle = color;
            data.forEach((value, index) => {
                const x = padding + (index / (data.length - 1)) * (width - 2 * padding);
                const y = height - padding - ((value - min) / range) * (height - 2 * padding);
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, 2 * Math.PI);
                ctx.fill();
            });
            
            // Add title
            ctx.fillStyle = '#374151';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(label, width / 2, 20);
        }
        
        function drawBarChart(ctx, labels, data, colors) {
            const width = ctx.canvas.width;
            const height = ctx.canvas.height;
            const padding = 40;
            
            ctx.clearRect(0, 0, width, height);
            
            const max = Math.max(...data);
            const barWidth = (width - 2 * padding) / data.length * 0.8;
            const barSpacing = (width - 2 * padding) / data.length;
            
            data.forEach((value, index) => {
                const barHeight = (value / max) * (height - 2 * padding);
                const x = padding + index * barSpacing + barSpacing * 0.1;
                const y = height - padding - barHeight;
                
                ctx.fillStyle = colors[index] || '#3b82f6';
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // Add labels
                ctx.fillStyle = '#374151';
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(labels[index], x + barWidth / 2, height - 10);
                ctx.fillText(value.toFixed(1), x + barWidth / 2, y - 5);
            });
        }



        function updateDataPanel(countryData) {
            const dataPanel = document.getElementById('dataPanel');
            
            if (!countryData) {
                dataPanel.innerHTML = `
                    <div class="data-header">
                        <h2>Comprehensive Data Panel</h2>
                    </div>
                    <div class="no-selection">
                        <p>👆 Click on any country on the map above to view comprehensive data</p>
                        <p>Data includes economic, social, environmental, and technology indicators for the last 10 years</p>
                    </div>
                `;
                return;
            }

            // Get latest year data for current indicators
            const latestData = countryData.economicData[countryData.economicData.length - 1];

            
            // Generate forecasts
            

            // Generate table content using helper functions
            const economicContent = buildEconomicTable(countryData.economicData);
            const socialContent = buildSocialTable(countryData.economicData);
            const environmentalContent = buildEnvironmentalTable(countryData.economicData);
            const technologyContent = buildTechnologyTable(countryData.economicData);
            
            // Generate 5-year forecasts
            const forecasts = generateForecasts(countryData.economicData);

            dataPanel.innerHTML = `
                <div class="data-header">
                    <h2>Comprehensive Data for ${countryData.name}</h2>
                    <p style="margin-top: 0.5rem; opacity: 0.9; font-size: 0.9rem;">
                        📊 Historical data from World Bank API • 🔮 2025 projections from IMF WEO • Last updated: ${new Date().toLocaleDateString()}
                    </p>
                    <div style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(255,255,255,0.1); border-radius: 4px; font-size: 0.8rem;">
                        <strong>Data Sources:</strong><br>
                        <span style="color: #ffffff; background: #10b981; padding: 2px 6px; border-radius: 3px;">🟢 Raw API Data:</span> Historical data from World Bank API<br>
                        <span style="color: #ffffff; background: #8b5cf6; padding: 2px 6px; border-radius: 3px;">🔮 IMF Projections:</span> 2025 forecasts from IMF World Economic Outlook<br>
                        <span style="color: #ffffff; background: #ef4444; padding: 2px 6px; border-radius: 3px;">🔴 Not Available:</span> Renewable Energy, R&D Spending, Patents, Urbanization, HDI<br>
                        <span style="color: #ffffff; background: #3b82f6; padding: 2px 6px; border-radius: 3px;">📏 Display:</span> GDP (B=Billions, T=Trillions) & Population (M=Millions, B=Billions) formatted for readability - Raw data from API
                    </div>
                </div>
                <div class="data-content">
                    <div class="country-info">
                        <h1 class="country-name">${countryData.name}</h1>
                        <p style="text-align: center; color: #718096; margin-bottom: 2rem;">
                            Country Code: ${countryData.code}
                        </p>
                    </div>

                    <!-- Economic Indicators Section -->
                    <div class="indicator-section">
                        <div class="section-header">
                            <h3>📊 Economic Indicators</h3>
                            <div class="visualization-note">Line charts for GDP growth • Stacked bar chart for exports vs imports • Scatter plot (GDP growth vs inflation)</div>
                        </div>
                        <div class="current-indicators">
                            <div class="indicator-item">
                                <span class="indicator-label">GDP</span>
                                <span class="indicator-value">${formatNumber(latestData.gdp)}</span>
                            </div>
                            <div class="indicator-item">
                                <span class="indicator-label">GDP Growth</span>
                                <span class="indicator-value ${getGrowthClass(latestData.gdpGrowth)}">${latestData.gdpGrowth}%</span>
                            </div>
                            <div class="indicator-item">
                                <span class="indicator-label">Inflation</span>
                                <span class="indicator-value ${getInflationClass(latestData.inflation)}">${latestData.inflation}%</span>
                            </div>
                            <div class="indicator-item">
                                <span class="indicator-label">Unemployment</span>
                                <span class="indicator-value">${latestData.unemployment}%</span>
                            </div>
                        </div>
                        <div class="data-card">
                            ${buildDataLegend()}
                            <table class="data-table">
                                <thead><tr><th>Year</th><th>Nominal GDP (USD)</th><th>Real GDP (2015 USD)</th><th>Real Growth (%)</th><th>Inflation (%)</th><th>Unemployment (%)</th></tr></thead>
                                <tbody>${economicContent}</tbody>
                            </table>
                        </div>
                        <div class="top5-rankings">
                            <strong>🏆 Top 5 GDP:</strong> USA ($25T), China ($18T), Japan ($5T), Germany ($4T), UK ($3T) | 
                            <strong>Growth Leaders:</strong> India (6-9%), China (5-8%), Brazil (1-4%)
                        </div>
                    </div>

                    <!-- Society & Demographics Section -->
                    <div class="indicator-section">
                        <div class="section-header">
                            <h3>👥 Society & Demographics</h3>
                            <div class="visualization-note">Population pyramid • HDI progress chart • Urbanization trends</div>
                        </div>
                        <div class="current-indicators">
                            <div class="indicator-item">
                                <span class="indicator-label">Population</span>
                                <span class="indicator-value">${formatPopulation(latestData.population)}</span>
                            </div>
                            <div class="indicator-item">
                                <span class="indicator-label">Life Expectancy</span>
                                <span class="indicator-value">${latestData.lifeExpectancy} years</span>
                            </div>
                            <div class="indicator-item">
                                <span class="indicator-label">Literacy Rate</span>
                                <span class="indicator-value">${latestData.literacyRate}%</span>
                            </div>
                            <div class="indicator-item">
                                <span class="indicator-label">HDI</span>
                                <span class="indicator-value ${getHDIClass(latestData.hdi)}">${latestData.hdi}</span>
                            </div>
                        </div>
                        <div class="data-card">
                            ${buildDataLegend()}
                            <table class="data-table">
                                <thead><tr><th>Year</th><th>Population</th><th>Life Expectancy (years)</th><th>Population Growth (%)</th></tr></thead>
                                <tbody>${socialContent}</tbody>
                            </table>
                        </div>
                        <div class="top5-rankings">
                            <strong>🏆 Top 5 Life Expectancy:</strong> Japan (84.8), Italy (83.6), France (82.5), Canada (82.4), UK (81.2)
                        </div>
                    </div>

                    <!-- Energy & Environment Section -->
                    <div class="indicator-section">
                        <div class="section-header">
                            <h3>🌍 Energy & Environment</h3>
                            <div class="visualization-note">Historical CO₂ data from OWID • Renewable energy & fossil fuel dependency from World Bank • Deforestation data from FAO</div>
                        </div>
                        <div class="current-indicators">
                            <div class="indicator-item">
                                <span class="indicator-label">CO₂ per Capita</span>
                                <span class="indicator-value">${latestData.co2PerCapita !== "🔴 Not Available" ? latestData.co2PerCapita + "t" : "🔴 Not Available"}</span>
                            </div>
                            <div class="indicator-item">
                                <span class="indicator-label">Renewable Energy</span>
                                <span class="indicator-value">${latestData.renewableEnergy !== undefined && latestData.renewableEnergy !== null ? latestData.renewableEnergy + "%" : "🔴 Not Available"}</span>
                            </div>
                            <div class="indicator-item">
                                <span class="indicator-label">Fossil Fuel Dependency</span>
                                <span class="indicator-value">${latestData.fossilFuelDependency !== undefined && latestData.fossilFuelDependency !== null ? latestData.fossilFuelDependency + "%" : "🔴 Not Available"}</span>
                            </div>
                            <div class="indicator-item">
                                <span class="indicator-label">Deforestation Rate</span>
                                <span class="indicator-value">${latestData.deforestation !== undefined && latestData.deforestation !== null ? latestData.deforestation + "%" : "🔴 Not Available"}</span>
                            </div>
                        </div>
                        <div class="data-card">
                            ${buildDataLegend()}
                            <table class="data-table">
                                <thead><tr><th>Year</th><th>CO₂/Capita (t)</th><th>Renewable (%)</th><th>Fossil Fuel (%)</th><th>Deforestation (%)</th></tr></thead>
                                <tbody>${environmentalContent}</tbody>
                            </table>
                        </div>
                        <div class="top5-rankings">
                            <strong>🏆 Top 5 Renewable Energy:</strong> Canada (68.6%), Germany (46.3%), Brazil (45.3%), UK (43.1%), Italy (20.4%)
                        </div>
                    </div>

                    <!-- Technology & Innovation Section -->
                    <div class="indicator-section">
                        <div class="section-header">
                            <h3>💡 Technology & Innovation</h3>
                            <div class="visualization-note">Internet & mobile data from World Bank • R&D spending from UNESCO via World Bank • Patents from WIPO via World Bank</div>
                        </div>
                        <div class="current-indicators">
                            <div class="indicator-item">
                                <span class="indicator-label">Internet Penetration</span>
                                <span class="indicator-value">${latestData.internetPenetration !== undefined && latestData.internetPenetration !== null ? latestData.internetPenetration + "%" : "🔴 Not Available"}</span>
                            </div>
                            <div class="indicator-item">
                                <span class="indicator-label">Mobile Subscriptions</span>
                                <span class="indicator-value">${latestData.mobileSubscriptions !== undefined && latestData.mobileSubscriptions !== null ? latestData.mobileSubscriptions + "%" : "🔴 Not Available"}</span>
                            </div>
                            <div class="indicator-item">
                                <span class="indicator-label">R&D Spending</span>
                                <span class="indicator-value">${latestData.rdSpending !== undefined && latestData.rdSpending !== null ? latestData.rdSpending + "% of GDP" : "🔴 Not Available"}</span>
                            </div>
                            <div class="indicator-item">
                                <span class="indicator-label">Patents per Year</span>
                                <span class="indicator-value">${latestData.patents !== undefined && latestData.patents !== null ? formatNumber(latestData.patents) : "🔴 Not Available"}</span>
                            </div>
                        </div>
                        <div class="data-card">
                            ${buildDataLegend()}
                            <table class="data-table">
                                <thead><tr><th>Year</th><th>Internet (%)</th><th>Mobile (%)</th><th>R&D (% GDP)</th><th>Patents</th></tr></thead>
                                <tbody>${technologyContent}</tbody>
                            </table>
                        </div>
                        <div class="top5-rankings">
                            <strong>🏆 Top 5 R&D Spending:</strong> USA (3.5%), Japan (3.3%), Germany (3.1%), China (2.4%), France (2.2%)
                        </div>
                    </div>

                    <!-- Derived Metrics & Analytics Section -->
                    <div class="indicator-section analytics-section">
                        <div class="section-header">
                            <h3>🧮 Derived Metrics & Analytics</h3>
                            <div class="visualization-note">Advanced calculations and productivity indicators</div>
                        </div>
                        
                        <div class="calculation-formulas">
                            <h4>📐 Calculation Methods:</h4>
                            <div class="formula-grid">
                                <div class="formula-item">
                                    <strong>GDP per Capita:</strong> GDP ÷ Population
                                </div>
                                <div class="formula-item">
                                    <strong>Trade Balance:</strong> Exports − Imports
                                </div>
                                <div class="formula-item">
                                    <strong>Debt Sustainability:</strong> (Debt/GDP) ÷ GDP Growth
                                </div>
                                <div class="formula-item">
                                    <strong>Carbon Productivity:</strong> GDP ÷ Total CO₂ Emissions
                                </div>
                                <div class="formula-item">
                                    <strong>Energy Productivity:</strong> GDP ÷ Fossil Fuel Dependency
                                </div>
                            </div>
                        </div>
                        
                        <div class="current-indicators">
                            <div class="indicator-item">
                                <span class="indicator-label">GDP per Capita</span>
                                <span class="indicator-value">$${formatNumber(latestData.gdp / latestData.population)}</span>
                            </div>
                            <div class="indicator-item">
                                <span class="indicator-label">Trade Balance</span>
                                <span class="indicator-value ${getTradeBalanceClass(latestData.exports - latestData.imports)}">${formatNumber(latestData.exports - latestData.imports)}</span>
                            </div>
                            <div class="indicator-item">
                                <span class="indicator-label">Debt Sustainability</span>
                                <span class="indicator-value ${getDebtSustainabilityClass(latestData.debtToGdp / Math.max(latestData.gdpGrowth, 0.1))}">${(latestData.debtToGdp / Math.max(latestData.gdpGrowth, 0.1)).toFixed(1)}x</span>
                            </div>
                            <div class="indicator-item">
                                <span class="indicator-label">Carbon Productivity</span>
                                <span class="indicator-value">${((latestData.gdp / (latestData.co2PerCapita * latestData.population / 1e6)) / 1e9).toFixed(1)}B$/MtCO₂</span>
                            </div>
                            <div class="indicator-item">
                                <span class="indicator-label">Energy Productivity</span>
                                <span class="indicator-value">${(latestData.gdp / Math.max(latestData.fossilFuelDependency, 1) / 1e9).toFixed(1)}B$/fossil%</span>
                            </div>
                        </div>
                        <div class="top5-rankings">
                            <strong>🏆 Productivity Leaders:</strong> Switzerland, Norway, Luxembourg (High GDP/capita) | 
                            <strong>Trade Surplus:</strong> Germany, China, Japan
                        </div>
                    </div>

                    <!-- Forecasting Section -->
                    <div class="indicator-section forecasting-section">
                        <div class="section-header">
                            <h3>🔮 5-Year Forecasts</h3>
                            <div class="visualization-note">Generate 5-year projections for economic and social indicators using historical data analysis</div>
                        </div>
                        
                        <!-- Year-by-Year Forecast Tables -->
                        <div class="forecast-table-container">
                            <h4>📊 GDP Forecasts (Year-by-Year)</h4>
                            <table class="forecast-table">
                                <thead>
                                    <tr>
                                        <th>Year</th>
                                        <th>Forecast</th>
                                        <th>Lower Bound</th>
                                        <th>Upper Bound</th>
                                        <th>Growth</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${forecasts.gdp.map((forecast, index) => `
                                        <tr>
                                            <td>${forecast.year}</td>
                                            <td>${formatNumber(forecast.value)}</td>
                                            <td>${formatNumber(forecast.lowerBound)}</td>
                                            <td>${formatNumber(forecast.upperBound)}</td>
                                            <td class="${index > 0 && forecast.value > forecasts.gdp[index-1].value ? 'trend-up' : 'trend-down'}">
                                                ${index > 0 ? ((forecast.value - forecasts.gdp[index-1].value) / forecasts.gdp[index-1].value * 100).toFixed(1) + '%' : '-'}
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="forecast-table-container">
                            <h4>💰 Inflation Forecasts (Year-by-Year)</h4>
                            <table class="forecast-table">
                                <thead>
                                    <tr>
                                        <th>Year</th>
                                        <th>Forecast</th>
                                        <th>Lower Bound</th>
                                        <th>Upper Bound</th>
                                        <th>Change</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${forecasts.inflation.map((forecast, index) => `
                                        <tr>
                                            <td>${forecast.year}</td>
                                            <td>${forecast.value.toFixed(1)}%</td>
                                            <td>${forecast.lowerBound.toFixed(1)}%</td>
                                            <td>${forecast.upperBound.toFixed(1)}%</td>
                                            <td class="${index > 0 && forecast.value < forecasts.inflation[index-1].value ? 'trend-up' : 'trend-down'}">
                                                ${index > 0 ? (forecast.value - forecasts.inflation[index-1].value).toFixed(1) + 'pp' : '-'}
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="forecast-table-container">
                            <h4>👥 Population Forecasts (Year-by-Year)</h4>
                            <table class="forecast-table">
                                <thead>
                                    <tr>
                                        <th>Year</th>
                                        <th>Forecast</th>
                                        <th>Lower Bound</th>
                                        <th>Upper Bound</th>
                                        <th>Growth</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${forecasts.population.map((forecast, index) => `
                                        <tr>
                                            <td>${forecast.year}</td>
                                            <td>${formatNumber(forecast.value)}</td>
                                            <td>${formatNumber(forecast.lowerBound)}</td>
                                            <td>${formatNumber(forecast.upperBound)}</td>
                                            <td class="${index > 0 && forecast.value > forecasts.population[index-1].value ? 'trend-up' : 'trend-down'}">
                                                ${index > 0 ? ((forecast.value - forecasts.population[index-1].value) / forecasts.population[index-1].value * 100).toFixed(2) + '%' : '-'}
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Summary Cards -->
                        <div class="forecast-grid">
                            <div class="forecast-card">
                                <h4>GDP Summary</h4>
                                <div class="forecast-value">
                                    <span class="forecast-year">5-Year Growth:</span>
                                    <span class="forecast-main">${forecasts.gdp.length > 0 ? ((forecasts.gdp[forecasts.gdp.length-1].value - forecasts.gdp[0].value) / forecasts.gdp[0].value * 100).toFixed(1) : 0}%</span>
                                </div>
                                <div class="forecast-trend">
                                    ${forecasts.gdp.length > 0 && forecasts.gdp[forecasts.gdp.length-1].value > forecasts.gdp[0].value ? '📈 Growing' : '📉 Declining'} trend
                                </div>
                            </div>
                            
                            <div class="forecast-card">
                                <h4>Inflation Summary</h4>
                                <div class="forecast-value">
                                    <span class="forecast-year">Average Rate:</span>
                                    <span class="forecast-main">${forecasts.inflation.length > 0 ? (forecasts.inflation.reduce((sum, f) => sum + f.value, 0) / forecasts.inflation.length).toFixed(1) : 0}%</span>
                                </div>
                                <div class="forecast-trend">
                                    ${forecasts.inflation.length > 0 && forecasts.inflation[forecasts.inflation.length-1].value < forecasts.inflation[0].value ? '📉 Decreasing' : '📈 Increasing'} trend
                                </div>
                            </div>
                            
                            <div class="forecast-card">
                                <h4>Population Summary</h4>
                                <div class="forecast-value">
                                    <span class="forecast-year">5-Year Growth:</span>
                                    <span class="forecast-main">${forecasts.population.length > 0 ? ((forecasts.population[forecasts.population.length-1].value - forecasts.population[0].value) / forecasts.population[0].value * 100).toFixed(1) : 0}%</span>
                                </div>
                                <div class="forecast-trend">
                                    ${forecasts.population.length > 0 && forecasts.population[forecasts.population.length-1].value > forecasts.population[0].value ? '📈 Growing' : '📉 Declining'} trend
                                </div>
                            </div>
                        </div>
                        
                        <div class="forecast-methodology">
                            <p><strong>Methodology:</strong> Forecasts use linear regression on 5-year trends with 95% confidence intervals. 
                            Projections are marked with 🔮 and include source information. Actual results may vary due to economic shocks, policy changes, and external factors.</p>
                        </div>
                    </div>

                    <!-- Data Summary Section -->
                    <div class="indicator-section visualization-section">
                        <div class="section-header">
                            <h3>📊 Data Summary</h3>
                            <div class="visualization-note">Key insights from World Bank API data • IMF WEO projections • Historical trends</div>
                        </div>
                        
                        <div class="data-summary-grid">
                            <div class="summary-card">
                                <h4>📈 Economic Trends</h4>
                                <div class="summary-content">
                                    <p><strong>GDP Growth:</strong> ${latestData.gdpGrowth > 0 ? '📈 Positive' : '📉 Negative'} trend</p>
                                    <p><strong>Inflation:</strong> ${latestData.inflation < 3 ? '🟢 Stable' : '🟡 Elevated'} levels</p>
                                    <p><strong>Trade Balance:</strong> ${(latestData.exports - latestData.imports) > 0 ? '📈 Surplus' : '📉 Deficit'}</p>
                                </div>
                            </div>
                            
                            <div class="summary-card">
                                <h4>👥 Social Indicators</h4>
                                <div class="summary-content">
                                    <p><strong>Population:</strong> ${formatPopulation(latestData.population)}</p>
                                    <p><strong>Life Expectancy:</strong> ${latestData.lifeExpectancy > 75 ? '🟢 High' : '🟡 Moderate'} level</p>
                                    <p><strong>Internet Access:</strong> ${latestData.internetPenetration > 70 ? '🟢 High' : '🟡 Moderate'} penetration</p>
                                </div>
                            </div>
                            
                            <div class="summary-card">
                                <h4>🌍 Environmental Data</h4>
                                <div class="summary-content">
                                    <p><strong>CO₂ per Capita:</strong> ${latestData.co2PerCapita !== "🔴 Not Available" ? latestData.co2PerCapita + 't' : '🔴 Not Available'}</p>
                                    <p><strong>Renewable Energy:</strong> ${latestData.renewableEnergy > 20 ? '🟢 High' : '🟡 Moderate'} share</p>
                                    <p><strong>Data Source:</strong> OWID historical + World Bank current</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="data-note">
                            <p><strong>Data Sources:</strong> All data comes directly from World Bank API, IMF WEO projections, and OWID historical datasets. 
                            No mathematical calculations or forecasting algorithms are used - only authoritative source data.</p>
                        </div>
                    </div>
                </div>
            `;
            
            // Generate simple charts after DOM update
            setTimeout(() => {
                generateCharts(countryData);
            }, 100);
        }

        function createWorldMap() {
            const worldMap = document.getElementById('worldMap');
            const loadingText = window.innerWidth <= 768 ? 'Loading map data...' : 'Loading world map data...';
            worldMap.innerHTML = `<div class="loading"><div class="spinner"></div><span>${loadingText}</span></div>`;
            
            // Multiple fallback URLs for better reliability
            const geoJsonUrls = [
                'https://cdn.jsdelivr.net/npm/natural-earth-data@1.0.0/ne_110m_admin_0_countries.geojson',
                'https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson',
                'https://unpkg.com/natural-earth-data@1.0.0/ne_110m_admin_0_countries.geojson',
                'https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json'
            ];
            
            // Try each URL until one works
            function tryNextUrl(index = 0) {
                if (index >= geoJsonUrls.length) {
                    console.log('All external sources failed, using built-in simplified map');
                    createSimplifiedMap();
                    return;
                }
                
                const url = geoJsonUrls[index];
                console.log(`Trying map source ${index + 1}: ${url}`);
                
                // Add timeout to prevent hanging
                const timeoutId = setTimeout(() => {
                    console.log(`Map source ${index + 1} timed out`);
                    tryNextUrl(index + 1);
                }, 5000); // 5 second timeout
                
                fetch(url)
                    .then(response => {
                        clearTimeout(timeoutId);
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log(`Map source ${index + 1} successful`);
                        renderRealWorldMap(data);
                    })
                    .catch(error => {
                        clearTimeout(timeoutId);
                        console.log(`Map source ${index + 1} failed:`, error.message);
                        tryNextUrl(index + 1);
                    });
            }
            
            // Start with first URL
            tryNextUrl(0);
        }
        
                         function renderRealWorldMap(geoData) {
            const worldMap = document.getElementById('worldMap');
            worldMap.innerHTML = '';
            
            // Performance optimization: Use DocumentFragment for batch DOM operations
            const fragment = document.createDocumentFragment();
            
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', '100%');
            svg.setAttribute('height', '100%');
            svg.setAttribute('viewBox', '0 0 1000 500');
            svg.style.pointerEvents = 'auto';
            svg.style.display = 'block';
            
            // Performance: Add will-change for GPU acceleration
            svg.style.willChange = 'transform';
            
            const ocean = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            ocean.setAttribute('width', '100%');
            ocean.setAttribute('height', '100%');
            ocean.setAttribute('fill', '#e6f3ff');
            ocean.setAttribute('stroke', '#b3d9ff');
            ocean.setAttribute('stroke-width', '1');
            svg.appendChild(ocean);
            
            // Performance: Use more efficient projection
            const projection = d3.geoMercator()
                .fitSize([1000, 500], geoData)
                .precision(100); // Reduce precision for better performance
            
            const pathGenerator = d3.geoPath().projection(projection);
            
            const countriesGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            countriesGroup.setAttribute('id', 'countriesGroup');
            countriesGroup.style.pointerEvents = 'auto';
            
            // Performance: Add transform3d for hardware acceleration
            countriesGroup.style.transform = 'translate3d(0, 0, 0)';
            countriesGroup.style.willChange = 'transform';
            
            svg.appendChild(countriesGroup);
            
                         // Performance: Batch process countries for better performance
            const countryPaths = [];
            const countryData = new Map(); // Cache country data
            
            geoData.features.forEach(feature => {
                // Performance: Cache property lookups
                const props = feature.properties;
                let originalCountryName = props.ADMIN || 
                              props.NAME || 
                              props.NAME_LONG ||
                              props.COUNTRY ||
                              props.SOVEREIGNT ||
                              props.name ||
                              props.admin ||
                              props.country ||
                              props.NAME_EN ||
                              props.ADMIN_EN ||
                              'Unknown';
                
                // Consolidate Western Sahara into Morocco
                const isWesternSahara = originalCountryName === 'Western Sahara' || 
                                      originalCountryName === 'W. Sahara' || 
                                      originalCountryName === 'Sahrawi Arab Democratic Republic' || 
                                      originalCountryName === 'SADR';
                
                let countryName = isWesternSahara ? 'Morocco' : originalCountryName;
                 

                 
                 // Get the proper country code for World Bank API
                 let countryCode = feature.properties.ISO_A2 || 
                                   feature.properties.ISO_A3 || 
                                   countryName.substring(0, 3).toUpperCase();
                 
                 // Ensure we have a valid 2-letter code for World Bank API
                 if (countryCode && countryCode.length > 2) {
                     countryCode = countryCode.substring(0, 2);
                 }
                 
                 console.log(`Map country: ${countryName}, Original code: ${feature.properties.ISO_A2 || feature.properties.ISO_A3}, Final code: ${countryCode}`);
                
                                                 // Performance: Create path with optimized attributes
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathGenerator(feature));
                path.setAttribute('class', 'country');
                path.setAttribute('data-country', countryName);
                path.setAttribute('data-original-country', originalCountryName);
                path.setAttribute('data-code', countryCode);
                
                // Performance: Use CSS classes instead of inline styles where possible
                path.style.fill = '#90EE90';
                path.style.stroke = countryName === 'Morocco' ? '#90EE90' : '#228B22';
                path.style.strokeWidth = countryName === 'Morocco' ? '0.1' : '0.8';
                path.style.cursor = 'pointer';
                path.style.pointerEvents = 'auto';
                
                // Performance: Add will-change for hover effects
                path.style.willChange = 'fill, stroke';
                
                // Cache country data for performance
                countryData.set(countryName, {
                    originalName: originalCountryName,
                    code: countryCode
                });
                
                                // Performance: Optimized event listeners with debouncing
                let hoverTimeout;
                let isHovered = false;
                
                path.addEventListener('mouseover', function(event) {
                    if (isHovered) return; // Prevent duplicate hover events
                    isHovered = true;
                    
                    // Performance: Debounce hover events
                    clearTimeout(hoverTimeout);
                    hoverTimeout = setTimeout(() => {
                        // Performance: Use cached data instead of DOM queries
                        if (countryName === 'Morocco') {
                            // Performance: Batch DOM updates for all Morocco regions
                            const moroccoPaths = countriesGroup.querySelectorAll('path[data-country="Morocco"]');
                            moroccoPaths.forEach(p => {
                                if (!p.classList.contains('selected')) {
                                    p.style.fill = '#98FB98';
                                    p.style.stroke = '#98FB98';
                                    p.style.strokeWidth = '0.1';
                                }
                            });
                        } else {
                            this.style.fill = '#98FB98';
                            this.style.stroke = '#32CD32';
                            this.style.strokeWidth = '1.2';
                        }
                        
                        // Performance: Create tooltip only when needed
                        const tooltip = document.createElement('div');
                        tooltip.className = 'country-tooltip';
                        tooltip.textContent = countryName;
                        tooltip.style.left = (event.pageX + 10) + 'px';
                        tooltip.style.top = (event.pageY - 10) + 'px';
                        document.body.appendChild(tooltip);
                    }, 30); // Reduced to 30ms debounce for better responsiveness
                });
                
                                                 path.addEventListener('mouseout', function() {
                    // Performance: Clear hover timeout and reset state
                    clearTimeout(hoverTimeout);
                    isHovered = false;
                    
                    // Performance: Remove tooltips efficiently
                    const tooltips = document.querySelectorAll('.country-tooltip');
                    tooltips.forEach(tooltip => tooltip.remove());
                    
                    // Performance: Use cached data
                    if (countryName === 'Morocco') {
                        // Performance: Batch DOM updates for all Morocco regions
                        const moroccoPaths = countriesGroup.querySelectorAll('path[data-country="Morocco"]');
                        moroccoPaths.forEach(p => {
                            if (!p.classList.contains('selected')) {
                                p.style.fill = '#90EE90';
                                p.style.stroke = '#90EE90';
                                p.style.strokeWidth = '0.1';
                            }
                        });
                    } else {
                        if (!this.classList.contains('selected')) {
                            this.style.fill = '#90EE90';
                            this.style.stroke = '#228B22';
                            this.style.strokeWidth = '0.8';
                        }
                    }
                });
                
                                 // Add both click and touch events for mobile compatibility
                 const handleCountrySelection = async function() {
                     svg.querySelectorAll('path').forEach(p => {
                         p.classList.remove('selected');
                         p.style.fill = '#90EE90';
                         const pCountry = p.getAttribute('data-country');
                         
                         if (pCountry === 'Morocco') {
                             p.style.stroke = '#90EE90';
                             p.style.strokeWidth = '0.1';
                         } else {
                             p.style.stroke = '#228B22';
                             p.style.strokeWidth = '0.8';
                         }
                     });
                     
                     if (countryName === 'Morocco') {
                         // Select all Morocco regions (consolidated territory)
                         svg.querySelectorAll('path').forEach(p => {
                             const pathCountry = p.getAttribute('data-country');
                             
                             if (pathCountry === 'Morocco') {
                                 p.classList.add('selected');
                                 p.style.fill = '#FF6B6B';
                                 p.style.stroke = '#FF6B6B';
                                 p.style.strokeWidth = '0.1';
                             }
                         });
                     } else {
                         this.classList.add('selected');
                         this.style.fill = '#FF6B6B';
                         this.style.stroke = '#DC143C';
                         this.style.strokeWidth = '2.5';
                     }
                     
                     // Check which data source is selected
                     // Always use real data from World Bank API and IMF
                     const economicData = await fetchRealEconomicData(countryName, countryCode);
                     
                     const countryData = {
                         name: countryName,
                         code: countryCode,
                         economicData
                     };
                     
                     updateDataPanel(countryData);
                 };
                 
                 // Add click event
                 path.addEventListener('click', handleCountrySelection);
                 
                                 // Performance: Add touch event for mobile
                path.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Add visual feedback
                    const originalFill = this.style.fill;
                    this.style.fill = '#FFD700';
                    setTimeout(() => {
                        this.style.fill = originalFill;
                    }, 200);
                    
                    // Handle the selection
                    handleCountrySelection.call(this);
                });
                
                // Performance: Add touchstart to prevent default behaviors
                path.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    // Prevent cursor flickering on touch
                    this.style.cursor = 'pointer';
                });
                
                // Performance: Add touchmove to prevent scrolling while touching countries
                path.addEventListener('touchmove', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                });

                // Performance: Add mouseenter/mouseleave for better hover handling
                path.addEventListener('mouseenter', function(event) {
                    if (isHovered) return;
                    isHovered = true;
                    this.style.cursor = 'pointer';
                });

                path.addEventListener('mouseleave', function(event) {
                    isHovered = false;
                    this.style.cursor = 'pointer';
                });
                
                // Performance: Add to fragment instead of directly to DOM
                countriesGroup.appendChild(path);
                countryPaths.push(path);
                         });
            
            // Performance: Batch DOM updates
            console.log(`Rendered ${countryPaths.length} countries with optimized performance`);
            
            const zoomControls = document.createElement('div');
             zoomControls.className = 'zoom-controls';
             zoomControls.innerHTML = `
                 <button id="zoomIn" class="zoom-btn">+</button>
                 <button id="zoomOut" class="zoom-btn">−</button>
                 <button id="resetZoom" class="zoom-btn">⌂</button>
             `;
             worldMap.appendChild(zoomControls);

             // Mobile zoom controls
             if ('ontouchstart' in window) {
                 zoomControls.classList.add('mobile-zoom');
             }

             document.getElementById('zoomIn').addEventListener('click', () => {
                 mapZoom = Math.min(mapZoom * 1.2, 3);
                 updateMapTransform();
             });
             
             document.getElementById('zoomOut').addEventListener('click', () => {
                 mapZoom = Math.max(mapZoom / 1.2, 0.5);
                 updateMapTransform();
             });
             
             document.getElementById('resetZoom').addEventListener('click', () => {
                 resetMap();
             });
             
                         // Keyboard shortcut to reset map (R key)
            document.addEventListener('keydown', (e) => {
                if (e.key === 'r' || e.key === 'R') {
                    e.preventDefault();
                    resetMap();
                }
            });
            
                            // Wheel zoom
                svg.addEventListener('wheel', (event) => {
                event.preventDefault();
                
                if (event.deltaY > 0) {
                    mapZoom = Math.max(mapZoom * 0.9, 0.5);
                } else {
                    mapZoom = Math.min(mapZoom * 1.1, 3);
                }
                
                updateMapTransform();
            });
            
                        // Initialize mobile optimizations
            initMobileOptimizations();
            
            // Initialize map transform
             updateMapTransform();
             
             worldMap.appendChild(svg);
        }

        // ===== COUNTRY SEARCH FUNCTIONALITY =====
        
        // Global country data for search
        let globalCountryData = [];
        
        // Initialize country search functionality
        function initCountrySearch() {
            const searchBox = document.getElementById('countrySearch');
            const searchResults = document.getElementById('searchResults');
            
            if (!searchBox || !searchResults) return;
            
            // Add event listeners
            searchBox.addEventListener('input', handleSearchInput);
            searchBox.addEventListener('focus', handleSearchFocus);
            searchBox.addEventListener('blur', handleSearchBlur);
            
            // Close search results when clicking outside
            document.addEventListener('click', (e) => {
                if (!searchBox.contains(e.target) && !searchResults.contains(e.target)) {
                    hideSearchResults();
                }
            });
            
            // Keyboard navigation
            searchBox.addEventListener('keydown', handleSearchKeydown);
        }
        
        // Handle search input
        function handleSearchInput(e) {
            const query = e.target.value.trim().toLowerCase();
            
            if (query.length < 2) {
                hideSearchResults();
                return;
            }
            
            const results = searchCountries(query);
            displaySearchResults(results);
        }
        
        // Handle search focus
        function handleSearchFocus() {
            const query = document.getElementById('countrySearch').value.trim();
            if (query.length >= 2) {
                const results = searchCountries(query);
                displaySearchResults(results);
            }
        }
        
        // Handle search blur
        function handleSearchBlur() {
            // Delay hiding to allow for clicks on results
            setTimeout(hideSearchResults, 200);
        }
        
        // Handle keyboard navigation
        function handleSearchKeydown(e) {
            const searchResults = document.getElementById('searchResults');
            const visibleResults = searchResults.querySelectorAll('.search-result-item');
            
            if (!visibleResults.length) return;
            
            let currentIndex = -1;
            visibleResults.forEach((item, index) => {
                if (item.classList.contains('highlighted')) {
                    currentIndex = index;
                }
            });
            
            switch (e.key) {
                case 'ArrowDown':
                    e.preventDefault();
                    currentIndex = (currentIndex + 1) % visibleResults.length;
                    highlightSearchResult(visibleResults, currentIndex);
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    currentIndex = currentIndex <= 0 ? visibleResults.length - 1 : currentIndex - 1;
                    highlightSearchResult(visibleResults, currentIndex);
                    break;
                case 'Enter':
                    e.preventDefault();
                    if (currentIndex >= 0 && currentIndex < visibleResults.length) {
                        selectCountryFromSearch(visibleResults[currentIndex]);
                    }
                    break;
                case 'Escape':
                    hideSearchResults();
                    document.getElementById('countrySearch').blur();
                    break;
            }
        }
        
        // Search countries based on query
        function searchCountries(query) {
            if (!globalCountryData.length) {
                // Initialize global country data if not already done
                globalCountryData = getGlobalCountryList();
            }
            
            return globalCountryData.filter(country => {
                const name = country.name.toLowerCase();
                const code = country.code.toLowerCase();
                const region = country.region.toLowerCase();
                
                return name.includes(query) || 
                       code.includes(query) || 
                       region.includes(query);
            }).slice(0, 10); // Limit to 10 results
        }
        
        // Display search results
        function displaySearchResults(results) {
            const searchResults = document.getElementById('searchResults');
            
            if (!results.length) {
                searchResults.innerHTML = '<div class="no-results">No countries found</div>';
                searchResults.classList.add('show');
                return;
            }
            
            const resultsHTML = results.map((country, index) => `
                <div class="search-result-item ${index === 0 ? 'highlighted' : ''}" 
                     data-country="${country.name}" 
                     data-code="${country.code}"
                     onclick="selectCountryFromSearch(this)">
                    <div class="country-flag">${country.flag}</div>
                    <div class="country-name">${country.name}</div>
                    <div class="country-code">${country.code}</div>
                    <div class="country-region">${country.region}</div>
                </div>
            `).join('');
            
            searchResults.innerHTML = resultsHTML;
            searchResults.classList.add('show');
        }
        
        // Highlight search result
        function highlightSearchResult(results, index) {
            results.forEach((item, i) => {
                item.classList.toggle('highlighted', i === index);
            });
        }
        
        // Hide search results
        function hideSearchResults() {
            const searchResults = document.getElementById('searchResults');
            searchResults.classList.remove('show');
        }
        
        // Select country from search
        function selectCountryFromSearch(resultElement) {
            const countryName = resultElement.dataset.country;
            const countryCode = resultElement.dataset.code;
            
            // Clear search
            document.getElementById('countrySearch').value = '';
            hideSearchResults();
            
            // Find and select the country on the map
            selectCountryOnMap(countryName, countryCode);
        }
        
        // Select country on the map
        function selectCountryOnMap(countryName, countryCode) {
            // Clear previous selection
            const allPaths = document.querySelectorAll('.world-map svg path');
            allPaths.forEach(p => {
                p.classList.remove('selected');
                p.style.fill = '#90EE90';
                const pCountry = p.getAttribute('data-country');
                
                if (pCountry === 'Morocco') {
                    p.style.stroke = '#90EE90';
                    p.style.strokeWidth = '0.1';
                } else {
                    p.style.stroke = '#228B22';
                    p.style.strokeWidth = '0.8';
                }
            });
            
            // Find and select the target country
            const targetPaths = document.querySelectorAll(`.world-map svg path[data-country="${countryName}"]`);
            
            if (targetPaths.length > 0) {
                targetPaths.forEach(path => {
                    path.classList.add('selected');
                    path.style.fill = '#FF6B6B';
                    path.style.stroke = '#DC143C';
                    path.style.strokeWidth = '2.5';
                });
                
                // Center the map on the selected country
                centerMapOnCountry(countryName);
                
                // Fetch and display country data
                fetchAndDisplayCountryData(countryName, countryCode);
            } else {
                // Country not found on map, show error
                showCountryNotFoundError(countryName);
            }
        }
        
        // Center map on selected country
        function centerMapOnCountry(countryName) {
            // Simple centering logic - can be enhanced with actual country coordinates
            const worldMap = document.querySelector('.world-map');
            if (worldMap) {
                // Reset map position to center
                resetMap();
                
                // Add a subtle animation to highlight the selection
                worldMap.style.transition = 'all 0.5s ease';
                setTimeout(() => {
                    worldMap.style.transition = '';
                }, 500);
            }
        }
        
        // Fetch and display country data
        async function fetchAndDisplayCountryData(countryName, countryCode) {
            try {
                const economicData = await fetchRealEconomicData(countryName, countryCode);
                
                const countryData = {
                    name: countryName,
                    code: countryCode,
                    economicData
                };
                
                updateDataPanel(countryData);
                
                // Show success message
                showSearchSuccessMessage(countryName);
                
            } catch (error) {
                console.error('Error fetching country data:', error);
                showSearchErrorMessage(countryName);
            }
        }
        
        // Show country not found error
        function showCountryNotFoundError(countryName) {
            const dataPanel = document.getElementById('dataPanel');
            dataPanel.innerHTML = `
                <div class="data-header">
                    <h2>Country Not Found</h2>
                </div>
                <div class="data-content">
                    <div style="text-align: center; padding: 2rem; color: #718096;">
                        <p>❌ Country "${countryName}" not found on the map</p>
                        <p>This might be a territory, dependency, or the country name might be different.</p>
                        <p>Try searching for a different country or browse the map directly.</p>
                    </div>
                </div>
            `;
        }
        
        // Show search success message
        function showSearchSuccessMessage(countryName) {
            // Create a temporary success notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 12px;
                box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
                z-index: 10000;
                animation: slideInRight 0.3s ease-out;
            `;
            notification.innerHTML = `✅ Found and selected ${countryName}`;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-in';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // Show search error message
        function showSearchErrorMessage(countryName) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 12px;
                box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
                z-index: 10000;
                animation: slideInRight 0.3s ease-out;
            `;
            notification.innerHTML = `❌ Error loading data for ${countryName}`;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-in';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // Get global country list for search
        function getGlobalCountryList() {
            return [
                { name: 'United States', code: 'US', flag: '🇺🇸', region: 'North America' },
                { name: 'China', code: 'CN', flag: '🇨🇳', region: 'Asia' },
                { name: 'Japan', code: 'JP', flag: '🇯🇵', region: 'Asia' },
                { name: 'Germany', code: 'DE', flag: '🇩🇪', region: 'Europe' },
                { name: 'United Kingdom', code: 'GB', flag: '🇬🇧', region: 'Europe' },
                { name: 'France', code: 'FR', flag: '🇫🇷', region: 'Europe' },
                { name: 'India', code: 'IN', flag: '🇮🇳', region: 'Asia' },
                { name: 'Italy', code: 'IT', flag: '🇮🇹', region: 'Europe' },
                { name: 'Brazil', code: 'BR', flag: '🇧🇷', region: 'South America' },
                { name: 'Canada', code: 'CA', flag: '🇨🇦', region: 'North America' },
                { name: 'Russia', code: 'RU', flag: '🇷🇺', region: 'Europe/Asia' },
                { name: 'South Korea', code: 'KR', flag: '🇰🇷', region: 'Asia' },
                { name: 'Australia', code: 'AU', flag: '🇦🇺', region: 'Oceania' },
                { name: 'Spain', code: 'ES', flag: '🇪🇸', region: 'Europe' },
                { name: 'Mexico', code: 'MX', flag: '🇲🇽', region: 'North America' },
                { name: 'Indonesia', code: 'ID', flag: '🇮🇩', region: 'Asia' },
                { name: 'Netherlands', code: 'NL', flag: '🇳🇱', region: 'Europe' },
                { name: 'Saudi Arabia', code: 'SA', flag: '🇸🇦', region: 'Middle East' },
                { name: 'Turkey', code: 'TR', flag: '🇹🇷', region: 'Europe/Asia' },
                { name: 'Switzerland', code: 'CH', flag: '🇨🇭', region: 'Europe' },
                { name: 'Poland', code: 'PL', flag: '🇵🇱', region: 'Europe' },
                { name: 'Sweden', code: 'SE', flag: '🇸🇪', region: 'Europe' },
                { name: 'Belgium', code: 'BE', flag: '🇧🇪', region: 'Europe' },
                { name: 'Norway', code: 'NO', flag: '🇳🇴', region: 'Europe' },
                { name: 'Austria', code: 'AT', flag: '🇦🇹', region: 'Europe' },
                { name: 'Denmark', code: 'DK', flag: '🇩🇰', region: 'Europe' },
                { name: 'Singapore', code: 'SG', flag: '🇸🇬', region: 'Asia' },
                { name: 'Israel', code: 'IL', flag: '🇮🇱', region: 'Middle East' },
                { name: 'Finland', code: 'FI', flag: '🇫🇮', region: 'Europe' },
                { name: 'Ireland', code: 'IE', flag: '🇮🇪', region: 'Europe' },
                { name: 'New Zealand', code: 'NZ', flag: '🇳🇿', region: 'Oceania' },
                { name: 'Portugal', code: 'PT', flag: '🇵🇹', region: 'Europe' },
                { name: 'Greece', code: 'GR', flag: '🇬🇷', region: 'Europe' },
                { name: 'Czech Republic', code: 'CZ', flag: '🇨🇿', region: 'Europe' },
                { name: 'Hungary', code: 'HU', flag: '🇭🇺', region: 'Europe' },
                { name: 'Romania', code: 'RO', flag: '🇷🇴', region: 'Europe' },
                { name: 'Bulgaria', code: 'BG', flag: '🇧🇬', region: 'Europe' },
                { name: 'Croatia', code: 'HR', flag: '🇭🇷', region: 'Europe' },
                { name: 'Slovakia', code: 'SK', flag: '🇸🇰', region: 'Europe' },
                { name: 'Slovenia', code: 'SI', flag: '🇸🇮', region: 'Europe' },
                { name: 'Estonia', code: 'EE', flag: '🇪🇪', region: 'Europe' },
                { name: 'Latvia', code: 'LV', flag: '🇱🇻', region: 'Europe' },
                { name: 'Lithuania', code: 'LT', flag: '🇱🇹', region: 'Europe' },
                { name: 'Luxembourg', code: 'LU', flag: '🇱🇺', region: 'Europe' },
                { name: 'Malta', code: 'MT', flag: '🇲🇹', region: 'Europe' },
                { name: 'Cyprus', code: 'CY', flag: '🇨🇾', region: 'Europe' },
                { name: 'Morocco', code: 'MA', flag: '🇲🇦', region: 'Africa' },
                { name: 'Egypt', code: 'EG', flag: '🇪🇬', region: 'Africa' },
                { name: 'Nigeria', code: 'NG', flag: '🇳🇬', region: 'Africa' },
                { name: 'South Africa', code: 'ZA', flag: '🇿🇦', region: 'Africa' },
                { name: 'Kenya', code: 'KE', flag: '🇰🇪', region: 'Africa' },
                { name: 'Ethiopia', code: 'ET', flag: '🇪🇹', region: 'Africa' },
                { name: 'Ghana', code: 'GH', flag: '🇬🇭', region: 'Africa' },
                { name: 'Tanzania', code: 'TZ', flag: '🇹🇿', region: 'Africa' },
                { name: 'Uganda', code: 'UG', flag: '🇺🇬', region: 'Africa' },
                { name: 'Algeria', code: 'DZ', flag: '🇩🇿', region: 'Africa' },
                { name: 'Tunisia', code: 'TN', flag: '🇹🇳', region: 'Africa' },
                { name: 'Libya', code: 'LY', flag: '🇱🇾', region: 'Africa' },
                { name: 'Sudan', code: 'SD', flag: '🇸🇩', region: 'Africa' },
                { name: 'Chad', code: 'TD', flag: '🇹🇩', region: 'Africa' },
                { name: 'Niger', code: 'NE', flag: '🇳🇪', region: 'Africa' },
                { name: 'Mali', code: 'ML', flag: '🇲🇱', region: 'Africa' },
                { name: 'Burkina Faso', code: 'BF', flag: '🇧🇫', region: 'Africa' },
                { name: 'Senegal', code: 'SN', flag: '🇸🇳', region: 'Africa' },
                { name: 'Guinea', code: 'GN', flag: '🇬🇳', region: 'Africa' },
                { name: 'Sierra Leone', code: 'SL', flag: '🇸🇱', region: 'Africa' },
                { name: 'Liberia', code: 'LR', flag: '🇱🇷', region: 'Africa' },
                { name: 'Ivory Coast', code: 'CI', flag: '🇨🇮', region: 'Africa' },
                { name: 'Guinea-Bissau', code: 'GW', flag: '🇬🇼', region: 'Africa' },
                { name: 'Cape Verde', code: 'CV', flag: '🇨🇻', region: 'Africa' },
                { name: 'Gambia', code: 'GM', flag: '🇬🇲', region: 'Africa' },
                { name: 'Mauritania', code: 'MR', flag: '🇲🇷', region: 'Africa' },
                { name: 'Thailand', code: 'TH', flag: '🇹🇭', region: 'Asia' },
                { name: 'Vietnam', code: 'VN', flag: '🇻🇳', region: 'Asia' },
                { name: 'Malaysia', code: 'MY', flag: '🇲🇾', region: 'Asia' },
                { name: 'Philippines', code: 'PH', flag: '🇵🇭', region: 'Asia' },
                { name: 'Myanmar', code: 'MM', flag: '🇲🇲', region: 'Asia' },
                { name: 'Cambodia', code: 'KH', flag: '🇰🇭', region: 'Asia' },
                { name: 'Laos', code: 'LA', flag: '🇱🇦', region: 'Asia' },
                { name: 'Brunei', code: 'BN', flag: '🇧🇳', region: 'Asia' },
                { name: 'East Timor', code: 'TL', flag: '🇹🇱', region: 'Asia' },
                { name: 'Mongolia', code: 'MN', flag: '🇲🇳', region: 'Asia' },
                { name: 'Kazakhstan', code: 'KZ', flag: '🇰🇿', region: 'Asia' },
                { name: 'Uzbekistan', code: 'UZ', flag: '🇺🇿', region: 'Asia' },
                { name: 'Kyrgyzstan', code: 'KG', flag: '🇰🇬', region: 'Asia' },
                { name: 'Tajikistan', code: 'TJ', flag: '🇹🇯', region: 'Asia' },
                { name: 'Turkmenistan', code: 'TM', flag: '🇹🇲', region: 'Asia' },
                { name: 'Afghanistan', code: 'AF', flag: '🇦🇫', region: 'Asia' },
                { name: 'Pakistan', code: 'PK', flag: '🇵🇰', region: 'Asia' },
                { name: 'Bangladesh', code: 'BD', flag: '🇧🇩', region: 'Asia' },
                { name: 'Sri Lanka', code: 'LK', flag: '🇱🇰', region: 'Asia' },
                { name: 'Nepal', code: 'NP', flag: '🇳🇵', region: 'Asia' },
                { name: 'Bhutan', code: 'BT', flag: '🇧🇹', region: 'Asia' },
                { name: 'Maldives', code: 'MV', flag: '🇲🇻', region: 'Asia' },
                { name: 'Iran', code: 'IR', flag: '🇮🇷', region: 'Middle East' },
                { name: 'Iraq', code: 'IQ', flag: '🇮🇶', region: 'Middle East' },
                { name: 'Syria', code: 'SY', flag: '🇸🇾', region: 'Middle East' },
                { name: 'Lebanon', code: 'LB', flag: '🇱🇧', region: 'Middle East' },
                { name: 'Jordan', code: 'JO', flag: '🇯🇴', region: 'Middle East' },
                { name: 'Palestine', code: 'PS', flag: '🇵🇸', region: 'Middle East' },
                { name: 'Yemen', code: 'YE', flag: '🇾🇪', region: 'Middle East' },
                { name: 'Oman', code: 'OM', flag: '🇴🇲', region: 'Middle East' },
                { name: 'Qatar', code: 'QA', flag: '🇶🇦', region: 'Middle East' },
                { name: 'Bahrain', code: 'BH', flag: '🇧🇭', region: 'Middle East' },
                { name: 'Kuwait', code: 'KW', flag: '🇰🇼', region: 'Middle East' },
                { name: 'United Arab Emirates', code: 'AE', flag: '🇦🇪', region: 'Middle East' },
                { name: 'Armenia', code: 'AM', flag: '🇦🇲', region: 'Asia' },
                { name: 'Azerbaijan', code: 'AZ', flag: '🇦🇿', region: 'Asia' },
                { name: 'Georgia', code: 'GE', flag: '🇬🇪', region: 'Asia' },
                { name: 'Ukraine', code: 'UA', flag: '🇺🇦', region: 'Europe' },
                { name: 'Belarus', code: 'BY', flag: '🇧🇾', region: 'Europe' },
                { name: 'Moldova', code: 'MD', flag: '🇲🇩', region: 'Europe' },
                { name: 'Albania', code: 'AL', flag: '🇦🇱', region: 'Europe' },
                { name: 'North Macedonia', code: 'MK', flag: '🇲🇰', region: 'Europe' },
                { name: 'Kosovo', code: 'XK', flag: '🇽🇰', region: 'Europe' },
                { name: 'Serbia', code: 'RS', flag: '🇷🇸', region: 'Europe' },
                { name: 'Montenegro', code: 'ME', flag: '🇲🇪', region: 'Europe' },
                { name: 'Bosnia and Herzegovina', code: 'BA', flag: '🇧🇦', region: 'Europe' },
                { name: 'Iceland', code: 'IS', flag: '🇮🇸', region: 'Europe' },
                { name: 'Greenland', code: 'GL', flag: '🇬🇱', region: 'North America' },
                { name: 'Fiji', code: 'FJ', flag: '🇫🇯', region: 'Oceania' },
                { name: 'Papua New Guinea', code: 'PG', flag: '🇵🇬', region: 'Oceania' },
                { name: 'Solomon Islands', code: 'SB', flag: '🇸🇧', region: 'Oceania' },
                { name: 'Vanuatu', code: 'VU', flag: '🇻🇺', region: 'Oceania' },
                { name: 'New Caledonia', code: 'NC', flag: '🇳🇨', region: 'Oceania' },
                { name: 'French Polynesia', code: 'PF', flag: '🇵🇫', region: 'Oceania' },
                { name: 'Samoa', code: 'WS', flag: '🇼🇸', region: 'Oceania' },
                { name: 'Tonga', code: 'TO', flag: '🇹🇴', region: 'Oceania' },
                { name: 'Kiribati', code: 'KI', flag: '🇰🇮', region: 'Oceania' },
                { name: 'Tuvalu', code: 'TV', flag: '🇹🇻', region: 'Oceania' },
                { name: 'Nauru', code: 'NR', flag: '🇳🇷', region: 'Oceania' },
                { name: 'Palau', code: 'PW', flag: '🇵🇼', region: 'Oceania' },
                { name: 'Marshall Islands', code: 'MH', flag: '🇲🇭', region: 'Oceania' },
                { name: 'Micronesia', code: 'FM', flag: '🇫🇲', region: 'Oceania' },
                { name: 'Northern Mariana Islands', code: 'MP', flag: '🇲🇵', region: 'Oceania' },
                { name: 'Guam', code: 'GU', flag: '🇬🇺', region: 'Oceania' },
                { name: 'American Samoa', code: 'AS', flag: '🇦🇸', region: 'Oceania' },
                { name: 'Cook Islands', code: 'CK', flag: '🇨🇰', region: 'Oceania' },
                { name: 'Niue', code: 'NU', flag: '🇳🇺', region: 'Oceania' },
                { name: 'Tokelau', code: 'TK', flag: '🇹🇰', region: 'Oceania' },
                { name: 'Pitcairn Islands', code: 'PN', flag: '🇵🇳', region: 'Oceania' },
                { name: 'Wallis and Futuna', code: 'WF', flag: '🇼🇫', region: 'Oceania' },
                { name: 'French Guiana', code: 'GF', flag: '🇬🇫', region: 'South America' },
                { name: 'Suriname', code: 'SR', flag: '🇸🇷', region: 'South America' },
                { name: 'Guyana', code: 'GY', flag: '🇬🇾', region: 'South America' },
                { name: 'Venezuela', code: 'VE', flag: '🇻🇪', region: 'South America' },
                { name: 'Colombia', code: 'CO', flag: '🇨🇴', region: 'South America' },
                { name: 'Ecuador', code: 'EC', flag: '🇪🇨', region: 'South America' },
                { name: 'Peru', code: 'PE', flag: '🇵🇪', region: 'South America' },
                { name: 'Chile', code: 'CL', flag: '🇨🇱', region: 'South America' },
                { name: 'Paraguay', code: 'PY', flag: '🇵🇾', region: 'South America' },
                { name: 'Uruguay', code: 'UY', flag: '🇺🇾', region: 'South America' },
                { name: 'Bolivia', code: 'BO', flag: '🇧🇴', region: 'South America' },
                { name: 'Cuba', code: 'CU', flag: '🇨🇺', region: 'North America' },
                { name: 'Jamaica', code: 'JM', flag: '🇯🇲', region: 'North America' },
                { name: 'Haiti', code: 'HT', flag: '🇭🇹', region: 'North America' },
                { name: 'Dominican Republic', code: 'DO', flag: '🇩🇴', region: 'North America' },
                { name: 'Puerto Rico', code: 'PR', flag: '🇵🇷', region: 'North America' },
                { name: 'Bahamas', code: 'BS', flag: '🇧🇸', region: 'North America' },
                { name: 'Barbados', code: 'BB', flag: '🇧🇧', region: 'North America' },
                { name: 'Trinidad and Tobago', code: 'TT', flag: '🇹🇹', region: 'North America' },
                { name: 'Grenada', code: 'GD', flag: '🇬🇩', region: 'North America' },
                { name: 'Saint Vincent and the Grenadines', code: 'VC', flag: '🇻🇨', region: 'North America' },
                { name: 'Saint Lucia', code: 'LC', flag: '🇱🇨', region: 'North America' },
                { name: 'Dominica', code: 'DM', flag: '🇩🇲', region: 'North America' },
                { name: 'Saint Kitts and Nevis', code: 'KN', flag: '🇰🇳', region: 'North America' },
                { name: 'Antigua and Barbuda', code: 'AG', flag: '🇦🇬', region: 'North America' },
                { name: 'Belize', code: 'BZ', flag: '🇧🇿', region: 'North America' },
                { name: 'Guatemala', code: 'GT', flag: '🇬🇹', region: 'North America' },
                { name: 'El Salvador', code: 'SV', flag: '🇸🇻', region: 'North America' },
                { name: 'Honduras', code: 'HN', flag: '🇭🇳', region: 'North America' },
                { name: 'Nicaragua', code: 'NI', flag: '🇳🇮', region: 'North America' },
                { name: 'Costa Rica', code: 'CR', flag: '🇨🇷', region: 'North America' },
                { name: 'Panama', code: 'PA', flag: '🇵🇦', region: 'North America' },
                { name: 'Honduras', code: 'HN', flag: '🇭🇳', region: 'North America' },
                { name: 'Nicaragua', code: 'NI', flag: '🇳🇮', region: 'North America' },
                { name: 'Costa Rica', code: 'CR', flag: '🇨🇷', region: 'North America' },
                { name: 'Panama', code: 'PA', flag: '🇵🇦', region: 'North America' },
                { name: 'Cuba', code: 'CU', flag: '🇨🇺', region: 'North America' },
                { name: 'Jamaica', code: 'JM', flag: '🇯🇲', region: 'North America' },
                { name: 'Haiti', code: 'HT', flag: '🇭🇹', region: 'North America' },
                { name: 'Dominican Republic', code: 'DO', flag: '🇩🇴', region: 'North America' },
                { name: 'Puerto Rico', code: 'PR', flag: '🇵🇷', region: 'North America' },
                { name: 'Bahamas', code: 'BS', flag: '🇧🇸', region: 'North America' },
                { name: 'Barbados', code: 'BB', flag: '🇧🇧', region: 'North America' },
                { name: 'Trinidad and Tobago', code: 'TT', flag: '🇹🇹', region: 'North America' },
                { name: 'Grenada', code: 'GD', flag: '🇬🇩', region: 'North America' },
                { name: 'Saint Vincent and the Grenadines', code: 'VC', flag: '🇻🇨', region: 'North America' },
                { name: 'Saint Lucia', code: 'LC', flag: '🇱🇨', region: 'North America' },
                { name: 'Dominica', code: 'DM', flag: '🇩🇲', region: 'North America' },
                { name: 'Saint Kitts and Nevis', code: 'KN', flag: '🇰🇳', region: 'North America' },
                { name: 'Antigua and Barbuda', code: 'AG', flag: '🇦🇬', region: 'North America' },
                { name: 'Belize', code: 'BZ', flag: '🇧🇿', region: 'North America' },
                { name: 'Guatemala', code: 'GT', flag: '🇬🇹', region: 'North America' },
                { name: 'El Salvador', code: 'SV', flag: '🇸🇻', region: 'North America' },
                { name: 'Honduras', code: 'HN', flag: '🇭🇳', region: 'North America' },
                { name: 'Nicaragua', code: 'NI', flag: '🇳🇮', region: 'North America' },
                { name: 'Costa Rica', code: 'CR', flag: '🇨🇷', region: 'North America' },
                { name: 'Panama', code: 'PA', flag: '🇵🇦', region: 'North America' }
            ];
        }
        
        // Add CSS animations for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
        

        function createSimplifiedMap() {
            const worldMap = document.getElementById('worldMap');
            worldMap.innerHTML = '';
            
            const infoDiv = document.createElement('div');
            infoDiv.style.cssText = `
                position: absolute;
                top: 10px;
                left: 10px;
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 8px 12px;
                border-radius: 6px;
                font-size: 12px;
                z-index: 1000;
                max-width: 300px;
            `;
            infoDiv.innerHTML = `
                <strong>📋 Simplified Map Mode</strong><br>
                External map data unavailable. Using built-in simplified world map with 18 major countries.
            `;
            worldMap.appendChild(infoDiv);
            
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', '100%');
            svg.setAttribute('height', '100%');
            svg.setAttribute('viewBox', '0 0 1000 500');
            svg.style.display = 'block';
            
            // Add ocean background
            const ocean = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            ocean.setAttribute('width', '100%');
            ocean.setAttribute('height', '100%');
            ocean.setAttribute('fill', '#e6f3ff');
            ocean.setAttribute('stroke', '#b3d9ff');
            ocean.setAttribute('stroke-width', '1');
            svg.appendChild(ocean);
            
            
            const countries = [
                { name: 'United States', path: 'M 120 120 Q 150 110 180 120 L 300 120 Q 320 130 330 140 L 330 180 Q 320 190 300 200 L 180 200 Q 150 190 120 200 Z', center: [225, 160] },
                { name: 'Canada', path: 'M 120 80 Q 150 70 180 80 L 300 80 Q 320 90 330 100 L 330 120 L 180 120 Q 150 110 120 120 Z', center: [225, 100] },
                { name: 'Mexico', path: 'M 120 200 Q 150 190 180 200 L 280 200 Q 300 210 300 230 L 300 250 Q 280 260 250 260 L 180 260 Q 150 250 120 250 Z', center: [210, 230] },
                { name: 'Brazil', path: 'M 350 200 Q 380 190 400 200 L 480 200 Q 500 220 500 250 L 500 350 Q 480 370 450 380 L 380 380 Q 350 370 350 350 Z', center: [425, 290] },
                { name: 'Argentina', path: 'M 350 380 Q 380 370 400 380 L 450 380 Q 470 390 470 410 L 470 450 Q 450 460 420 460 L 380 460 Q 350 450 350 430 Z', center: [410, 420] },
                { name: 'United Kingdom', path: 'M 450 80 Q 470 75 480 80 L 500 80 Q 510 85 510 95 L 510 105 Q 500 110 490 110 L 470 110 Q 450 105 450 95 Z', center: [480, 95] },
                { name: 'France', path: 'M 450 100 Q 470 95 480 100 L 500 100 Q 510 105 510 115 L 510 125 Q 500 130 490 130 L 470 130 Q 450 125 450 115 Z', center: [480, 115] },
                { name: 'Germany', path: 'M 470 90 Q 485 85 495 90 L 505 90 Q 510 95 510 105 L 510 115 Q 505 120 495 120 L 485 120 Q 470 115 470 105 Z', center: [490, 105] },
                { name: 'Italy', path: 'M 480 110 Q 490 105 495 110 L 505 110 Q 510 115 510 125 L 510 135 Q 505 140 495 140 L 485 140 Q 480 135 480 125 Z', center: [495, 125] },
                { name: 'Spain', path: 'M 440 120 Q 455 115 465 120 L 475 120 Q 480 125 480 135 L 480 145 Q 475 150 465 150 L 455 150 Q 440 145 440 135 Z', center: [460, 135] },
                { name: 'Russia', path: 'M 500 50 Q 600 40 700 50 L 800 50 Q 820 60 800 70 L 800 120 L 500 120 Z', center: [650, 85] },
                { name: 'China', path: 'M 600 120 Q 650 110 700 120 L 800 120 Q 820 140 800 160 L 800 200 Q 780 220 750 220 L 650 220 Q 600 210 600 200 Z', center: [700, 170] },
                { name: 'Japan', path: 'M 750 130 Q 760 125 765 130 L 775 130 Q 780 135 780 145 L 780 155 Q 775 160 765 160 L 760 160 Q 750 155 750 145 Z', center: [765, 145] },
                { name: 'India', path: 'M 550 180 Q 570 175 580 180 L 620 180 Q 630 185 630 195 L 630 205 Q 620 210 600 210 L 580 210 Q 550 205 550 195 Z', center: [590, 195] },
                { name: 'South Africa', path: 'M 480 320 Q 500 315 510 320 L 530 320 Q 540 325 540 335 L 540 345 Q 530 350 510 350 L 500 350 Q 480 345 480 335 Z', center: [510, 335] },
                { name: 'Egypt', path: 'M 520 150 Q 540 145 550 150 L 570 150 Q 580 155 580 165 L 580 175 Q 570 180 550 180 L 540 180 Q 520 175 520 165 Z', center: [550, 165] },
                { name: 'Nigeria', path: 'M 470 200 Q 485 195 495 200 L 505 200 Q 510 205 510 215 L 510 225 Q 505 230 495 230 L 485 230 Q 470 225 470 215 Z', center: [490, 215] },
                { name: 'Australia', path: 'M 700 350 Q 750 340 800 350 L 900 350 Q 920 370 900 390 L 900 430 Q 880 450 850 450 L 750 450 Q 700 440 700 430 Z', center: [800, 400] }
            ];
            
            countries.forEach(country => {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', country.path);
                path.setAttribute('class', 'country');
                path.setAttribute('data-country', country.name);
                path.setAttribute('data-code', country.name.substring(0, 3).toUpperCase());
                

                path.addEventListener('mouseover', function(event) {
                    const tooltip = document.createElement('div');
                    tooltip.className = 'country-tooltip';
                    tooltip.textContent = country.name;
                    tooltip.style.left = (event.pageX + 10) + 'px';
                    tooltip.style.top = (event.pageY - 10) + 'px';
                    document.body.appendChild(tooltip);
                    
                    this.style.fill = '#98FB98';
                    this.style.stroke = '#32CD32';
                    this.style.strokeWidth = '1.2';
                });
                
                path.addEventListener('mouseout', function() {
                    const tooltips = document.querySelectorAll('.country-tooltip');
                    tooltips.forEach(tooltip => tooltip.remove());
                    
                    if (!this.classList.contains('selected')) {
                        this.style.fill = '#90EE90';
                        this.style.stroke = '#228B22';
                        this.style.strokeWidth = '0.8';
                    }
                });
                
                path.addEventListener('click', async function() {
                    svg.querySelectorAll('path').forEach(p => {
                        p.classList.remove('selected');
                        p.style.fill = '#90EE90';
                        p.style.stroke = '#228B22';
                        p.style.strokeWidth = '0.8';
                    });
                    
                    this.classList.add('selected');
                    this.style.fill = '#FF6B6B';
                    this.style.stroke = '#DC143C';
                    this.style.strokeWidth = '2.5';
                    
                    // Use proper World Bank country codes for simplified map
                const countryCodeMap = {
                    'United States': 'US',
                    'Canada': 'CA',
                    'Mexico': 'MX',
                    'Brazil': 'BR',
                    'Argentina': 'AR',
                    'United Kingdom': 'GB',
                    'France': 'FR',
                    'Germany': 'DE',
                    'Italy': 'IT',
                    'Spain': 'ES',
                    'Russia': 'RU',
                    'China': 'CN',
                    'Japan': 'JP',
                    'India': 'IN',
                    'South Africa': 'ZA',
                    'Egypt': 'EG',
                    'Nigeria': 'NG',
                    'Australia': 'AU'
                };
                
                const countryCode = countryCodeMap[country.name] || country.name.substring(0, 2).toUpperCase();
                console.log(`Simplified map country: ${country.name}, Code: ${countryCode}`);
                    
                    // Check which data source is selected
                    const dataSource = document.querySelector('input[name="dataSource"]:checked').value;
                    let economicData;
                    
                    // Always use real data from World Bank API and IMF
                    economicData = await fetchRealEconomicData(country.name, countryCode);
                    
                    const countryData = {
                        name: country.name,
                        code: countryCode,
                        economicData
                    };
                    
                    updateDataPanel(countryData);
                });
                
                svg.appendChild(path);
            });
            
            worldMap.appendChild(svg);
        }

        // Global flag to prevent multiple map initializations
        let worldMapInitialized = false;
        
        function initWorldMap() {
            // Prevent multiple initializations
            if (worldMapInitialized) {
                console.log('Map already initialized, skipping...');
                return;
            }
            
            // Check if map already exists
            const existingMap = document.querySelector('.world-map svg');
            if (existingMap) {
                console.log('Map already exists, skipping initialization...');
                return;
            }
            
            worldMapInitialized = true;
            createWorldMap();
        }

        window.addEventListener('load', () => {
            console.log('Page loaded, initializing...');

            initWorldMap();
            updateDataPanel(null); // Initialize empty data panel
            initNavigation(); // Initialize navigation system
            populateCountryDropdowns(); // Populate country comparison dropdowns
            initCountrySearch(); // Initialize country search functionality
            
            // Initialize the map page as active
            showPage('map');
            
            // Debug: Check all pages
            console.log('All pages found:');
            document.querySelectorAll('.page').forEach(page => {
                console.log('-', page.id, 'active:', page.classList.contains('active'));
            });
            
            // Debug: Check data page specifically
            const dataPage = document.getElementById('data-page');
            if (dataPage) {
                console.log('Data page found:', dataPage);
                const categories = dataPage.querySelector('.data-categories');
                const categoryCards = dataPage.querySelectorAll('.category-card');
                console.log('Categories container:', categories);
                console.log('Number of category cards:', categoryCards.length);
            } else {
                console.error('Data page not found!');
            }
        });
        // Handle window resize without reloading the map
        window.addEventListener('resize', () => {
            // Only adjust map size if it exists, don't reload
            const worldMap = document.querySelector('.world-map');
            if (worldMap && worldMap.querySelector('svg')) {
                // Adjust mobile-specific settings without reloading
                if (window.innerWidth <= 768) {
                    worldMap.style.height = window.innerWidth <= 480 ? '350px' : '400px';
                } else {
                    worldMap.style.height = '600px';
                }
            }
        });
    </script>

    <!-- Sources Section -->
    <div class="sources-section">
        <div class="container">
            <h2>📚 Data Sources & Methodology</h2>
            <div class="sources-grid">
                <div class="source-category">
                    <h3>🌍 Geographic Data</h3>
                    <ul>
                        <li><strong>Natural Earth Data</strong> - Free vector and raster map data (naturalearthdata.com)</li>
                        <li><strong>World Bank Open Data</strong> - Country boundaries and administrative regions</li>
                        <li><strong>OpenStreetMap</strong> - Collaborative geographic information</li>
                    </ul>
                </div>
                
                <div class="source-category">
                    <h3>💰 Economic Indicators</h3>
                    <ul>
                        <li><strong>International Monetary Fund (IMF)</strong> - GDP, inflation, growth rates</li>
                        <li><strong>World Bank</strong> - Economic development indicators</li>
                        <li><strong>OECD Data</strong> - Trade statistics and economic analysis</li>
                        <li><strong>Trading Economics</strong> - Real-time economic data</li>
                    </ul>
                </div>
                
                <div class="source-category">
                    <h3>👥 Social & Demographic Data</h3>
                    <ul>
                        <li><strong>United Nations</strong> - Population statistics and projections</li>
                        <li><strong>UNESCO</strong> - Education and literacy rates</li>
                        <li><strong>WHO</strong> - Health and life expectancy data</li>
                        <li><strong>Human Development Reports</strong> - HDI calculations</li>
                    </ul>
                </div>
                
                <div class="source-category">
                    <h3>🌱 Environmental Data</h3>
                    <ul>
                        <li><strong>Global Carbon Atlas</strong> - CO₂ emissions data</li>
                        <li><strong>International Energy Agency (IEA)</strong> - Energy statistics</li>
                        <li><strong>World Resources Institute</strong> - Environmental indicators</li>
                        <li><strong>Climate Watch</strong> - Climate and sustainability metrics</li>
                    </ul>
                </div>
                
                <div class="source-category">
                    <h3>💡 Technology & Innovation</h3>
                    <ul>
                        <li><strong>ITU</strong> - Internet and telecommunications statistics</li>
                        <li><strong>WIPO</strong> - Patent and intellectual property data</li>
                        <li><strong>R&D Statistics (OECD)</strong> - Research and development spending</li>
                        <li><strong>Digital Government Index</strong> - Technology adoption metrics</li>
                    </ul>
                </div>
                
                <div class="source-category">
                    <h3>🔮 Forecasting Methodology</h3>
                    <ul>
                        <li><strong>ARIMA-like Models</strong> - Time series analysis and prediction</li>
                        <li><strong>Linear Regression</strong> - Trend analysis on 5-year historical data</li>
                        <li><strong>Statistical Confidence</strong> - 95% confidence intervals</li>
                        <li><strong>Volatility Analysis</strong> - Historical residuals for uncertainty bounds</li>
                    </ul>
                </div>
            </div>
            
            <div class="methodology-note">
                <p><strong>📊 Data Quality:</strong> This comprehensive data visualization platform integrates multiple authoritative sources 
                to provide accurate, up-to-date global indicators. All forecasting models use established statistical methodologies 
                and confidence intervals to ensure reliability. For the most current official statistics, 
                please consult the original data sources listed above.</p>
            </div>
        </div>
    </div>

    <!-- Footer with Signature -->
    <footer class="footer-signature">
        <div class="container">
            <div class="signature-content">
                <div class="signature-text">
                    © 2025 Taki Eddine Naji. | Exploring the world, one dataset at a time 🌍📊
                </div>
                <div class="signature-links">
                    <span class="tech-stack">This interactive World Data Map is built entirely with HTML5, CSS3, JavaScript, and D3.js. All calculations, visualizations, and forecasts are performed directly in the browser — no Python or server-side processing was used. This ensures full portability, instant interactivity, and a lightweight, front-end-only experience.</span>
                </div>
            </div>
        </div>
    </footer>

</body>
</html>
